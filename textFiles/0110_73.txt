ABSTRACT 
This project focuses on the implementation of an inexpensive autonomous Unmanned 
Aerial Vehicle (UAV) system. By its nature, it requires two fundamental elements to 
operate, the aerial vehicle itself and a Ground Control Station (GCS) software. 
For the aerial vehicle, a quad rotor helicopter is built based on a design named 
Aeroquad [1]. It is a remote controlled quad copter with an embedded microcontroller 
and several sensors. Its software is open source making it cheap and flexible to modify. 
For the completion of this project, the open source software is integrated to a UAV 
featuring: 
? Autonomous navigation between different positions defined by the user 
? Communication link establishment with the GCS using an Internet  connection 
? Uninterruptable flight on communication link error events 
? Amendment of missions during flight 
On the other hand, GCS software is developed for the control and configuration of the 
UAV. This software successfully provides the user options to: 
? Calibrate the vehicle sensors 
? Configure the communication link 
? Plan the UAVÕs mission, 
? Track the vehicle on the globe in real time 
? View the current state of the UAVÕs orientation 
  NOMENCLATURE 
ADC  Analogue to Digital Converter 
DCM  Direction Cosine Matrix 
DOF  Degrees Of Freedom 
ESC  Electronic Speed Controller 
GCS   Ground Control Station 
GIS  Geographic Information System 
GPRS  General Packet Radio Service 
GPS   Global Positioning System 
GSM   Global System for Mobile 
HUD  Head-Up Display 
2
IC   Inter-Integrated Circuit 
IMU  Inertial Measurement Unit 
MEMS   Micro Electro Mechanical Systems 
NMEA   National Marine Electronics Association 
PCB  Printed Circuit Board 
PID  Proportional Integral Derivative 
PWM  Pulse Width Modulation 
RC   Remote Controlled 
TCP/IP  Transmission Control Protocol / Internet Protocol 
UAV  Unmanned Aerial Vehicle 
UCS  Universal Character Set 
UART  Universal Asynchronous Receive Transmit 
UTF-8   UCS Transformation Format Ñ 8-bit 
VTOL  Vertical Take Off and Landing  
WGS84  World Geodetic System (revised in 2004)  ACKNOWLEDGEMENTS 
 
I would like to thank my project advisor Dr. Paul Warr for his valuable advice and 
guidance and inspiration during my studies at University of Bristol and specifically for 
the advice towards the completion of this project. Also, I would like to thank all of the 
academic staff for the knowledge I earned during this year. I would also like to thank my 
friend Yiannis helping me with proof reading. Last but not least, I would like to express 
my gratitude to my family for their support during my studies. 
 
  TABLE OF CO ONTENTS S 
 
Tabl le of Contents s ................................................................................................................................................ 4Ê
1.Ê INTRODUC CTION ....................................................................................................................................... 6Ê
1..1.Ê Aim an nd Objectives .......................................................................................................................... 7Ê
1.1.1Ê Unm manned Aerial l Vehicle Obje ectives ......................................................................................... 7Ê
1.1.2Ê Ground Control S Station Objecttives ............................................................................................. 9Ê
2.Ê THEORETIC CAL BACKG GROUND ON N UAVs ...................................................................................... 11Ê
2..1.Ê Unman nned Aerial V Vehicles (UAV Vs) .............................................................................................. 11Ê
2..2.Ê Quad R Rotor Helicop pters .................................................................................................................. 12Ê
2.2.1Ê How w a Quad Roto or Works .......................................................................................................... 12Ê
2..3.Ê PID Co ontroller ................................................................................................................................. 13Ê
2.3.1Ê The e three parame eters P, I and D D ................................................................................................ 14Ê
2..4.Ê UAVÕs s sensors and orientation de etermination ............................................................................... 16Ê
2.4.1Ê Iner rtial Measurem ment Units ........................................................................................................ 16Ê
2.4.2Ê Flig ght Control and DCM Relatti ion ............................................................................................. 17Ê
2.4.3Ê Posi itioning System e ..................................................................................................................... 21Ê
2.4.4Ê Mag gnetometers ............................................................................................................................ 23Ê
2.4.5Ê Coll lision/Obstacl le Avoidance .................................................................................................... 23Ê
2.4.6Ê Baro ometers .................................................................................................................................. 23Ê
2.4.7Ê Elec ctronic Speed Controllers an nd Motors .................................................................................. 24Ê
2.4.8Ê Sensor Interfacing g ...................................................................................................................... 24Ê
2..5.Ê Wirele ess Communic c ation ................................................................................................................ 26Ê
3.Ê THEORETIC CAL BACKG GROUND ON N GCS ......................................................................................... 27Ê
3..1Ê Tasks a and Instrumen ntation of a Gr round Control Station ............................................................... 28Ê
3..2Ê Missio on planning an nd navigation overview ................................................................................... 29Ê
3..3Ê Comm munication ............................................................................................................................... 29Ê
4.Ê IMPLEMEN NTATION ............................................................................................................................... 31Ê
4..1.Ê UAV D Design - Hard dware ................................................................................................................ 31Ê
4.1.1Ê Fram me design ............................................................................................................................... 31Ê
4.1.2Ê Hardware/PCB de esign ................................................................................................................ 31Ê
4.1.3Ê The e UAV Assem mbled ................................................................................................................. 35Ê
4..2Ê The UA AV Software .......................................................................................................................... 36Ê
4.2.1Ê Autopilot Algorit thm Approach h ................................................................................................. 38Ê
4.2.2Ê Seri ial communica ation ................................................................................................................. 42Ê
4.2.3Ê Com mmunication L Link Establish hment ......................................................................................... 42Ê
4..3Ê GCS S Solution appro oach .................................................................................................................. 45Ê
4.3.1Ê Com mmunication l link handler ...................................................................................................... 45Ê
4.3.2Ê The e Configuration View ............................................................................................................. 46Ê
4.3.3Ê The e Mission Plan nner View ......................................................................................................... 48Ê
4.3.4Ê The e Flight Data V View ................................................................................................................. 49Ê5.Ê RESULTS ............................................................................................................................................. 50Ê
5.1.Ê Testing the Control loop rate ....................................................................................................... 50Ê
5.2.Ê Autonomous Navigation Algorithm Test..................................................................................... 51Ê
5.3.Ê Communication Link Tests .......................................................................................................... 53Ê
5.4.Ê GCS Functionality Tests .............................................................................................................. 53Ê
6.Ê EVALUATION ..................................................................................................................................... 54Ê
7.Ê FUTURE WORK .................................................................................................................................. 55Ê
8.Ê BIBLIOGRAPHY ................................................................................................................................. 56Ê
9.Ê APPENDICES ...................................................................................................................................... 58Ê
9.1.Ê UAV System User Manual .............................................................................................................. 58 
9.2.Ê PCB Hardware Design - Interface .................................................................................................... 60Ê
 
List of Figures 
 
Figure 1: Pitch, roll and Yaw flight dynamics .............................................................................................. 11Ê
Figure 2:  a) Motor structure of quad rotor helicopter Ê    b) 6 Degrees Of Freedom ................................. 13Ê
Figure 3: a) Abstract view of a PID ControllerÊ      b) The Block diagram of the Controller [6] ............... 14Ê
Figure 4: The ÒPÓ parameter effect ............................................................................................................... 14Ê
Figure 5: The ÒIÓ parameter effect ................................................................................................................ 15Ê
Figure 6: a) Aircraft - earth coordinate systemsÊ b) Illustrated rotation ...................................................... 17Ê
Figure 7: Orientation calculation procedure .................................................................................................. 20Ê
Figure 8: PWM operation .............................................................................................................................. 25Ê
Figure 9: I2C bus with 2 devices ................................................................................................................... 25Ê
Figure 10: structured components approach of a GCS software [18]. .......................................................... 27Ê
Figure 11: A sample HUD for visualization of flight data [19] .................................................................... 28Ê
Figure 12: Sample packet format .................................................................................................................. 29Ê
Figure 13: Control Block diagram ................................................................................................................ 32Ê
Figure 14: Microcontroller board used as computational unit [21]. .............................................................. 32Ê
Figure 15: Sensors used ................................................................................................................................ 33Ê
Figure 16: The new PCB designed ................................................................................................................ 34Ê
Figure 17: The UAV assembled .................................................................................................................... 35Ê
Figure 18: The Block diagram of the open source software already exists [1] ............................................. 36Ê
Figure 19: The block diagram of the flight software after integration .......................................................... 37Ê
Figure 20: Block diagram of solution approach ............................................................................................ 38Ê
Figure 21: Illustration of the PIDÕs Òset pointÓ ............................................................................................. 39Ê
Figure 22: Autonomous navigation PID controller effect ............................................................................. 41Ê
Figure 23: The Configuration View of the GCS ........................................................................................... 47Ê
Figure 24: Mission planner view of the GCS ................................................................................................ 48Ê
Figure 25: Flight data view of the GCS ........................................................................................................ 49Ê
Figure 26: The Control loop rate before and after the UAV software integration ........................................ 50Ê
Figure 27: The GPS Navigation algorithm is disabled .................................................................................. 51Ê
Figure 28: The GPS Navigation algorithm is enabled ................................................................................... 52Ê
 
List of tables 
Table 1: Synopsis of PID parameters effects ................................................................................................ 16Ê
Table 2: Sample NMEA sentence [11].......................................................................................................... 22Ê1. INTRODUCTION 
 
UAVs were firstly and still being developed for military purposes such as covert 
reconnaissance, security and post disaster analysis. Over the past decade, UAVs demand 
have been grown exponentially when such a system stopped serving just military, but 
also civilian needs. They are nowadays found in a variety of fields. Geographic 
Information System (GIS) services are using UAVs for maps updating. They are also 
being used by environmental analysts for various observations and predictions. Some 
movie scenes were also taken by such vehicles. 
What it makes these systems more and more popular, is the reduced complexity of 
their flight control which can be achieved by a non-expert pilot. All the difficulties of 
controlling commands are now done by software enabling a user to fly them easily and 
securely.  Furthermore, vertical take-off and landing (VTOL) UAVs have a big advantage 
over the other types as they are commonly used in areas consisting of abrupt altitude 
changes such as inhabitant areas. Hence, rapid vertical climb or vertical decent is crucial. 
This project focuses on the implementation of a complete UAV system. It includes both 
the aerial vehicle software and hardware needs as well as the GCS platform. 
For the aerial vehicle, a low-cost remote controlled quad-rotor helicopter was 
used as it features stable flights [1]. The control software is open source and the 
computational unit is a microcontroller which can be programmed to meet the flight 
autonomy requirements. This also reduces its cost, which is a main constraint of the 
project.  
Within this project, a low cost remote controlled model is transformed into an 
efficient UAV able to navigate autonomously. Furthermore, the aircraft is able to 
navigate safely to its station in case of a communication link error. The communication 
between the aircraft and the ground control station is long ranged as the General Packet 
Radio Service (GPRS) was used.  
Consequently, a GCS application was developed. This application is responsible 
to initialize the aircraft by performing several pre-flight tasks. It also provides a user 
friendly environment for mission planning and is programmed to receive real-time 
information that is coming from the UAV. Last but not least, it visually tracks the 
aircraftÕs route on map while keep logs of the flight data for further analysis or 
simulation. 
 For the development of this project several areas were studied. These areas cover 
both software and hardware implementation needs. Sensor interfaces, communication 
link protocols and different technology availabilities were studied. Furthermore, 
mathematical models regarding the aircraft orientation have been analysed. Finally, the 
components should exist on a state-of-the-art ground control system application and the 
role of each was discovered and implemented in a way providing a user friendly 
interface.   
Stefanos Constantinou, Advanced Microelectronic Systems Engineering, 2011   6 
 1.1. Aim and Object tives 
 
Alth hough UAV Vs are very y popular, th hey are not found in c civilian appllications ye et due to 
thei ir high cost on research h and electro onic compo onents requiired for theiir developm ment. 
 The aim m of the pr roject is the e integration n of an inex xpensive, op pen source, remote 
con ntrolled qua ad rotor helicopter to a an efficient t UAV. Thiis includes the design and the 
imp plementation n of the aircraftÕs fframe, the Printed C Circuit Boaard (PCB) design 
inte erfacing the e required sensors, as w well as the integration n of the cur rrrent softwa are to an 
auto opilot.   
 The sec cond main p part of the project is f focused on tthe implem mentation of f Ground 
Con ntrol Statio on (GCS) software ab ble to intera act in real time with the aerial vehicle. 
Fur rthermore fo or the comm munication of the two s systems, an n application n protocol h has been 
defi fined that m makes use of the Tran nsport Con ntrol Protoc col/Internet Protocol (TCP/IP) 
mak king the sys stem web ba ased. 
 
1.1.1 Unman nned Aeria al Vehicle O Objectives
 
? Design n of the aircr raftÕs frame e  
? Design n of a PCB in nterfacing tthe required d sensors wiith a microc controller 
? Integra ation of the s software ab ble to receiv ve and transm mit data in r real time us sing 
 Genera al Packet Ra adio Service e (GPRS) 
? Integra ation of the s software to hold its alti itude set by the user du uring flight 
? Integra ation of the s software to hold it posi ition at a wa aypoint 
? Integra ation of the s software to travel betw ween two wa aypoints 
? Integra ation of the s software to navigate se ecurely on c communicattion link failures 
? Integra ation of the s software to perform au uto take-off and auto lan nding 
 
1.1..1.1 UAV Objectives s Analysis
 
Des sign of the a aircraftÕs fr frame:  
 
The e frame of t the UAV is s designed b by followin ng the guide elines of the e open sour rce quad 
roto or helicopte er [1]. Its setup is sele ected to be medium siized as it o offers stabil lity over 
win nd, further p payload capabilities and d long fligh hts. 
 
  
Stef fanos Constantinou, Advanc ced Microelec ctronic System ms Engineering g, 2011  7 
 Design of a PCB interfacing sensors with the microcontroller: 
 
The PCB design and implementation was a result of studying the sensors of the quad 
rotorÕs architecture [1]. It was then amended to a new design featuring all the required 
sensors to provide an autonomous flight such as: 
? 3 axis gyroscope for attitude calculations 
? 3 axis accelerometer for roll-pitch drift corrections 
? 3 axis magnetometer for autonomous navigation complementing Global 
Positioning SystemÕs (GPS). 
? GPS for autonomous navigation and yaw corrections 
? GPRS for communication 
 
Integration of the software able to receive and transmit data using GPRS service: 
 
The communication link between the microcontroller and the GPRS module has been 
implemented. The system is able to manipulate sockets for data transmission and 
reception. Furthermore, an application layer protocol between the aircraft and the GCS 
has been defined. A sample of such a protocol is presented in the ÒTheoretical 
Background on GCSÓ, found in chapter 3. The UAV is able to have a real time 
bidirectional communication link with the GCS over the Internet. The communication 
link is used for the real time amendment of the UAVÕs mission, as well as for the 
generation of the artificial instrumentation and tracking on the GCS. 
 
Integration of the software able to hold its altitude set by user: 
  
The aircraft makes use of the barometer to hold a user set altitude during navigation. As 
there is no low cost sensor to calculate altitude over ground, but both GPS and barometer 
measures altitude over sea level, it is left to the user to set a safe altitude for navigation. 
 
 
Integration of the software able to hold its position: 
 
Position hold is the ability of the aircraft to hover at the destination point by utilizing 
GPS. For the achievement of that objective an algorithm has been developed taking into 
account the inaccuracy of the positioning system as it is usually about a radius of 10-20 
meters. The algorithm stabilises the aircraft regardless any external force (such as wind) 
applied on the aircraft. The aircraft is designed to hold its position on the last position 
that exists in the mission list. However, a user can use the GCS-UAV communication to 
set any position he or she decides as last position. 
 
Stefanos Constantinou, Advanced Microelectronic Systems Engineering, 2011   8 
 Inte egration of f the softwar re able to tr ravel betwee en two coor rdinate posiitions: 
  
The e UAV vehi icle is able t to travel bettween different coordin nate points autonomou usly. The 
soft tware imple ementing this feature is s analysed in n chapter 4..2.1. 
 
Inte egration of f the softwar re to return n to base on n a commun nication link k failure: 
 
Com mmunicatio on links are vulnerable, especially y when it is built on th he e unreliable e Global 
Sys stem for Mobiles (GSM M) service and the In nternet where each pac cket of data a has to 
trav vel through some activ ve network e equipment (switches, r routers) unttil the destin nation is 
reac ched. For th his reason th he UAV is designed to o accomplish its missio ons even in the case 
of a a communic cation link f failure. Afte er the last po osition is re eached (base e), the UAV V hovers 
hold ding its pos sition until t the operator r takes the m manual conttrol to land iit. 
 
Inte egration of f the softwa are to perfo orm auto ta ake-off and d landing:  
  
The e UAV sho ould utilize the capabillities of the e barometer r and a rang ge finder sensor to 
perf form autom matic take-of ffs and land dings contro olled by the GCS. 
. 
1.1.2 Ground Control S Station Ob bjectives 
 
? Implem mentation of f an applicattion layer p protocol betw ween the UA AV and the e GCS. 
? Design n of a GCS S modulariz zed as obse erved in the e GCS bac ckground ch hapter 3 
 contain ning: 
o Mission pla anning mod dule 
o Flight data Ð instrume entation visu ualizer module 
o Configurat tion module e 
 
1.1..2.1 GCS Objectives s Analysis
 
 
Des sign and im mplementati ion of a com mmunicatio on protocol between the e UAV and d the 
GC CS 
The e TCP/IP tr ransport pro otocol was used. On top of it, a a telnet-typ pe applicatio on layer 
prottocol was d defined imp plementing tthe commu unication between the U UAV and th he GCS. 
The e application n protocol i is a similar message w with the one covered by y sub-chapte er 3.3 in 
the ÒTheoretica al backgrou und on GCS SÓ. 
Stef fanos Constantinou, Advanc ced Microelec ctronic System ms Engineering g, 2011  9 
 Design of a ground control station modularized as observed in the theoretical 
background chapter 3 
The GCS software was developed in a visual object-oriented language. The software has 
mainly three views (modules), each one performing a role. These views are: 
? Mission planning 
? Flight Data 
? Configuration 
The GCS makes use of open source Google EarthÕs libraries for the virtual globe 
presentation. Asynchronous socket programming algorithms written for the 
communication link establishment and Serial Port programming were used for the wired 
communication with the vehicle for its configuration, initialization and calibration of pre-
flight procedures. 
Implementation of mission planning module: 
The mission planning view is user friendly environment where a user can design the 
desired missions for the aircraft to travel. The GCS makes use of open source Google 
EarthÕs libraries for the virtual globe presentation. The positions are placed by the user as 
ÔclicksÕ, are then converted to missions and are sent to the UAV.  
Implementation of flight data view of the UAV: 
The GCS tracks the position of the aircraft in real time. This is done by analysing the data 
sent from the UAV to the GCS. The data is visualised on the map not just as a dot, but as 
a moving arrow clarifying the UAVÕs orientation with respect to North. 
Implementation of artificial instrumentation of the UAV: 
The user, despite the tracking information is able to observe the current state of the 
vehicle in terms of its orientation. It is provided with information such as: number of 
satellites the GPS is listening from, the speed over ground and inertial information like 
pitch and roll angles with respect to level position. Last but not least, the user can view 
the azimuth of the aircraft. 
  
Stefanos Constantinou, Advanced Microelectronic Systems Engineering, 2011   10 
 2. THEORETICAL BACKGROUND ON UAVS 
 
Despite that the project can be characterised as an implementation project, several areas 
were studied for the implementation of each objective. This chapter is dedicated to the 
research made on the UAVs and especially the VTOL ones. It analyses the different 
approaches used to control the aircraftÕs orientation and stabilisation which are then used 
to develop the autopilot and the communication system. 
 
2.1.  Unmanned Aerial Vehicles (UAVs) 
 
Unmanned Aerial Vehicles are characterised by small size and light weight [2]. They are 
also defined as unmanned (non-pilot) systems. Therefore, they make use of a wide 
variety of sensors to fill this absence in order to have stable and accurate flights. Due to 
their small size, multiple sensors and minimal space, they usually have some limitations, 
as most embedded systems do. These features and limitations in payload, size, power 
resources and computation power is what it needs to be balanced during the design of 
such a system. 
 Two main types of UAVs are available [3]; the rotary wing and fixed wing. Both 
of them have their advantages as well as some disadvantages. Fixed wing models feature 
less power consumption than rotary wing. On the other hand, they require enough 
distance for take-off and landing. Rotary wing models are also divided in two categories; 
the helicopters and multi-rotor helicopters (same axis Ð reverse rotation) with latter 
featuring simplified design but whatÕs more, stable flights.  
 Each aircraft (fixed-wing or rotary-wing) has three flight dynamic parameters 
known as pitch, roll and yaw as shown in Figure 1. These are basically three angles 
which are used to describe the orientation of the UAV at any given time. 
 
  
Figure 1: Pitch, roll and yaw flight dynamics 
 
 
  
Stefanos Constantinou, Advanced Microelectronic Systems Engineering, 2011   11 
 2.2. Quad Rotor Hel licopters 
 
Qua ad rotor he elicopters ar re naturally y very unst table aircraf fts as they have no notion of 
aero odynamics, thus the e ease of theiir design. H However, th he variety o of installed sensors 
mak kes them ve ery stable V VTOL aircra afts.  
Anothe er key featur re of such m model is its propellers. In summar ry, the propellers of 
sma all quad rotor aircrafts s consist of two main n physical p properties, their diame eter and 
pitc ch. The firs st has to do o with the r required thr rust for the model to h hover, whic ch again 
dep pends on the e size and t the weight of the UAV V. The seco ond is the v vertical dista ance the 
o 
airc craft achieve es by 360 r rotation. For r a stable m model to be u used in aeriial photogra aphy and 
cov vert reconna aissance, pr ropellers w with large di iameter and d small pitc ch should b be used. 
The ese are nam med Òslow-flyÓ propeller rs. 
 A quad d rotor mod del, as show wn in the Figure 2, is c cross structu ured [4]. It features 
two o sets of m motor-propel llers. One s set rotates c counter clockwise (mo otors 2, 4) and the 
othe er set clock kwise (moto ors 1, 3). Th his characte eristic simplly performs s the role of f the tail 
mot tor on the tr raditional h helicopter m models. This s model stru ucture has tw wo main ro oles. It is 
used for balanc cing the aircraft, and p providing th he required a angles durin ng flight. These are 
both h achieved by controlling the spe eed of each h rotor individually an nd getting f feedback 
from m the installed sensors. 
2.2.1 How a Quad Roto or Works
 
For r the quad c copters to a achieve rolll angles, th he ÔRightÕ m motor (referrring to Fig gure 2a) 
incr reases its s speed while e the ÔLeftÕ motor de ecreases or vice-versa depending g on the 
requ uired angle e. At the sa ame time, tthe other set of rotors s (ÒFront-R RearÓ) balan nces the 
veh hicle to avoid yaw ang gles by incre easing or d decreasing speed to can ncel out the e torque. 
Thi is is achieve ed due to th he Òleft-righ htÓ rotors ro otating clock kwise, oppo osite to Òfro ont-rearÓ 
whi ich are rotat ting counter r clockwise e. Similarly, for pitch an ngles the sa ame concept t applies 
on Ò ÒFront Ð Re earÓ motors and Òleft-riightÓ as bala ancers. 
 For the e adjustmen nt of the ya aw angles, the whole set (Òleft-riightÓ) of cl lockwise 
mot tors is incre eases in speed while th he set of cou unter clockw wise motors s decreases in speed 
to a achieve cloc ckwise angles. The opp posite is app plied for cou unter clockw wise angles. 
 One ma ay wonder h how much e each motor has to incre ease or decr rease its spe eed. The 
answ wer to this s is the Pro oportional-I Integral-De erivative (PID) controlller. Rough hly, PID 
con ntroller has an input, th hree gain p parameters a and an outp put in a clo osed-loop st tructure. 
The e input of th he controlle er is the Òse et pointÓ. A An example can be the e pitch angle e a pilot 
sets s to its quad d rotor by p pushing/pullling the yok ke (transmittter stick) to o a specifie ed value. 
The e PID contr roller is resp ponsible to adjust the m motor speed ds (output) tto match th hat angle 
by r reading the e Inertial Measurementt Unit (IMU U) (feedback k). The gain n parameter rs of the 
PID D controller r are three constant va alues which h are used to define tthe response of the 
Stef fanos Constantinou, Advanc ced Microelec ctronic System ms Engineering g, 2011  12 
 con ntroller in te erms of rise time, ove ershoot, set ttling time and steady- -state error. An in-
dep pth analysis of how PID D controllers s work can be found in n sub-chapte er 2.3.  
 As sho own in Figu ure 2b, the e aircraft h has six degrees of fre eedom (6 D DOF) of 
according to it ts structure and therefo ore, the com mputational unit should d be able to o receive 
feed dback of its s current mo otion state c continuously y for balanc cing the qua ad and to up pdate its 
attit tude. For th his reason, th he appropriiate sensors should be iinterfaced to o generate r real time 
com mmands to t the rotors. T The approp priate sensor r for X, Y and Z vecto or measurem ments is 
the triaxial acc celerometer r. For the d determinatio on of ?x, ? ?y and ?z a angles, a th hree-axis 
gyr roscope can be used. 
 
  
   
Figu ure 2:  a) Mot tor structure e of quad roto or helicopter    b) 6 Degre ees Of Freedo om 
 
2.3. PID C Controller 
 
PID D controller r is a closed d loop systtem as show wn in Figur re 3a [5]. I In theory, it t can be 
app plied to con ntrol any pr rocess with h measurab ble output. The e variaable represents the 
erro or. It is actu ually the dif fference bettween a Ôse et point RÕ a and Ôoutputt YÕ. The si ignal ÔuÕ 
is: 

          Equatio on 1 

  

 
Signnal ÔuÕ is adjusting t the process s (ÔplantÕ) and conseq quently a n new Ôoutpu ut YÕ is 
gen nerated. It is s fed back t to the contro oller to reca alculate the error e and d then its de erivative 
and d its integra al at the sa ame time. This proce ess runs inf finitely. Ea ach loopÕs iteration 
atte empts to ma ake ÔuÕ equa al to the Ôsett point RÕ b by giving th he required s signal to the e ÔplantÕ 
to in ncrease or d decrease.  
 A comm mon examp ple for a PID D controlle er is the cen ntral heating g: The user sets the 
desirable temp perature (Ôset pointÕ). T The PID co ontroller re eads a temp perature sen nsor and 
calc culates the error e (=Õset pointÕ Ð Ôcurrent temperatur reÕ). The P PID control ller then 
Stef fanos Constantinou, Advanc ced Microelec ctronic System ms Engineering g, 2011  13 
 
  calc culates the s signal u. Th hat signal is enough to inform the h heating unitt to increase e power, 
dec crease powe er or stop.  
 The sam me concept applies on small UAV Vs. The Ôset pointÕ is a r reference value can 
be s set by moving the tran nsmitterÕs sttick. The PID controller generate es motor com mmands 
to in ncrease or d decrease the eir speeds. T The Ôcurren nt dataÕ for error calcullation is ma aintained 
by t the installed d sensors (IM MU). 
 
 
Figu ure 3: a) Abst tract view of a PID Contr roller      b) The Block k diagram of t the Controlle er [6]  
 
2.3.1 The three parame eters P, I and D 
 
A P PID controll ler has three e gain param meters. These are consttant parame eters which are used 
to m make the PID controller as fast, ac ccurate and stable as po ossible.  
 
? Kp (pr roportional g gain parame eter) is used d to decrease the rise tim me and the steady-
state er rror. Howev ver it canno ot eliminate it. The term m is given in n the form o of: 
P = Kp p ? e and ha as the follow wing effect:
 
 
 
Figure 4: The ÒPÓ parameter effec ct 
As illustrated in Figure 4 4, a high K Kp results to o a faster atttainment o of the systemÕs Ôset 
poin ntÕ, howeve er it also pro oduces an u unstable syst tem with os scillations a around the set point. 
If th he Kp is set t to a low v value, the sy ystem will b be stable bu ut the exact Ôset pointÕ value is 
not reached (st tabilization below or ab bove the set t point). 
Stef fanos Constantinou, Advanc ced Microelec ctronic System ms Engineering g, 2011  14 
 ? Ki (integral gain parameter) is used to eliminate the steady-state error but results 
in overshoot (signal oscillation around the Ôset pointÕ). The term is given in the 
form of: 
           Equation 2 

 and is effect is shown in Figure 5: 
 
 
 
Figure 5: The ÒIÓ parameter effect 
 
In a system with low Kp values (stable), the way Ki is affected is shown in Figure 5. The 
red line shows the response in the case the Ki gain selected is high. The system response 
is fast but also causes a large overshoot. Despite the large overshoot, the system 
stabilises on the Ôset pointÕ value. While the Ki gain decreases, the system response is 
slower but the stabilization is faster. 
 
? Kd (derivative parameter) is used to stabilise the system. This is the last term and 
its given by the formula: 
          
 
 Equation 3 
 This term is used to calculate the rate of change error. If the rate of change of the 
 error is slow, the derivative gain term must be increased for the PID controller to 
 achieve a faster response. If the rate of change of the error is fast, then the 
 derivative gain term is decreased for the system to be stable. 
 
  
Stefanos Constantinou, Advanced Microelectronic Systems Engineering, 2011   15 
 
 
A synoptic view of the eff fects of each h gain term is shown by Table 1 fo ollows. 
 
T Table 1: Syno opsis of PID parameters e effects 
Pa arameter Rise time e O Overshoot Settlin ng time Steady-stat te error 
Kp Decrease e I Increase Minor d decrease Decrea ase 
Ki Decrease e I Increase Incr rease Eliminat tion 
Kd M Minor decre ease Min nor decrease e Decr rease Minor dec crease 
 
The e mathemati ical model o of a PID con ntrollerÕs ou utput is ther refore:  
 

            Equatio on 4 

  

 
2.4. UAVÕs s sensors a and orient tation dete ermination n 
 
Usu ually the sen nsors are in nstalled on a a UAV are s subject to itts mission a activities. H However, 
all aircrafts re equire som me basic se ensors to o operate. These are: IM MU, the G GPS, the 
com mmunication n media a and a proc cessing uni it. The IM MU is noth hing else but the 
com mbination of the sensor rs required to measure e acceleratio on and the sensors req quired to 
mea asure chang ges in rotatio on.   
 For the e navigation n and contro ol of the air rcraft, orien ntation is th he key role. For this 
to be calcula ated, rotation group theories m must be a applied on the IMU U sensor 
mea asurements.. Hence, the e orientatio on of the air rcraft can b be representted as rotati ion with 
resp pect to eart th [7]. ThatÕs the role of the Dire ection Cosin ne Matrix ( (DCM). The e matrix 
elem ments can b be maintain ned by the gyroscopes s, accelerom meters, the positioning g system 
and d the magnetometers. 
 
2.4.1 Inertia al Measurem ment Units s 
 
IMU Us are responsible to p provide mea asurements to the proc cessing unit  with respect to the 
airc craftÕs body y coordinat tes [7]. Th hese sensor rs are usua ally based on Micro- -Electro-
Mechanical Sy ystems (ME EMS) technnology, hence are very small, llight and lo ow-cost. 
How wever, due to these a advantages,  they suffe er from ina accuracy [8 8]. For this reason, 
several sensor rs were com mbined, ea ach comple ementing th he other, in n order to provide 
accu urate data t to the contr rol system. The most im mportant m measuremen ntts of an aircraft for 
stab bility and at ttitude contr rol are the a acceleration n and the angular velociity in all 3 a axes [4]. 
Acc celeration in n 3D space can be mea asured by tri iaxial accele erometers a and angular velocity 
by three-axis gyroscopes s. Attitude in simple models us sed to be c calculated only by 
Stef fanos Constantinou, Advanc ced Microelec ctronic System ms Engineering g, 2011  16 
 
   gyr roscopes. H However, f for a fully y stabilize ed flight, accelerome eters, GPS and/or 
mag gnetometers s are require ed to correc ct the gyrosc cope errors.. 
Ref ferring to Fi igure 2a , Let I = {e , e e , e } be the e earthÕs ine ertial frame e, where e p points to 
1 2 3 1
mag gnetic north h and e is th he vertical d direction. 
3
b b b b
 The cen ntre of its body frame c can be deno oted as B = {e , e , e }. A rotation of R: 
1 2 3
?      Equation n 5 represen nts the relatiion of DCM M and Euler r angles. 
Effe fectively, R matrix is t the required d data for expressing the orienta ation of the aircraft 
with h respect to o ground.  
 
  	Ð 	          	 	   
R=    Equatio on 5 
   	  	        	Ð 	  
      
The e three angle es are therefore roll ( ?) ), pitch ( ?), yaw ( ?).  
 
 
Fi igure 6: a) Aircraft - earth h coordinate sy sstems b) ) Illustrated r rotation 
Ref ferring to Figure 6b, Ôa aÕ is the pro ojection of aircraftÕs Ôx xÕ down on n earthÕs ÔxÕ. While 
unit t vectors w were used in n the rotatio on matrix, ÔaÕ is the co osine of the e rotation an ngle. By 
calc culating the e dot produc ct of aircraf ftÕs ÔxÕ with h earthÕs ÔxÕ, ÔaÕ can b be observed. Hence, 
the angle can b be calculated by taking g the arccosi ine of ÔaÕ. 
 Similar rly, ÔbÕ is th he projectio on of aircra aftÕs ÔyÕ on n earthÕs ÔyÕÕ. Again, Ôb bÕ is the 
cosine of the ro otation angl le as soon a as unit vecto ors are used in the rotattion matrix. As the 
eart thÕs coordin nate system m is assum med fixed, a any rotation n of the aiircraftÕs coordinate 
syst tem implies s that the air rcraft has ro otated. 
 
2.4.2 Flight Control an nd DCM Re elation 
 
 
Stef fanos Constantinou, Advanc ced Microelec ctronic System ms Engineering g, 2011  17 
 
 
 
  
 	Ð  	 	   	 
If the R=   is 
  	   	 	Ð  	
   
r r r
r r r
rewritten as R   for simplicity, then the way the  
r r r
  
  
Stefanos Constantinou, Advanced Microelectronic Systems Engineering, 2011   18 
 
  
  DCM is applied on the aircraft as observed from [9] is described below: 
? For the pitch control of the aircraft, the current pitch angle must be known. This 
can be determined by calculating the dot product of the aircraftÕs roll axis with the 
earthÕs ÔyÕ. The direction cosine r is the dot product of the roll axis with the 
zx
earthÕs ÔyÕ. However,  r is zero when the aircraft is in level position. 
zx
? Similarly for the roll control, the current pitch must be known. This can be found 
by calculating the dot product of pitch axis with the earthÕs ÔyÕ. Furthermore, r 
zy
can be found with the dot product of the pitch axis with earthÕs ÔyÕ. Again, r is 
zy
zero when the aircraft is in level position. 
? The direction for navigation can be determined by the GPS course. Hence the yaw 
attitude is given by calculating the cross product of roll axis of the UAV with the 
desired direction vector. A test however must be made firstly to observe if the 
vehicle is not oriented opposite to its destination. That information is determined 
by calculating the dot product of the roll axis with the vector of the desired 
direction. That will give the course and if that is negative, the aircraft must rotate 
(yaw axis) more than 90 degrees to recover its correct orientation. 
 As the interest is focused on the horizontal components only, the z are set to zero, 
  0
 therefore the vector is 	  . The cross product of this vector with the 
 direction wanted, gives the sine of the angle the aircraft is off course. 
? The vehicle is in reverse (upside down) if the dot product of yaw axis of the 
vehicle with vertical axis is negative. The dot product of the aircraftÕs yaw axis 
with the earthÕs ÔyÕ, will give the r of the matrix. If the aircraft is directed 
zz 
opposite it destination, a zero is obtained.  
? The rate of turning around the earthÕs ÔyÕ axis can be determined by the dot 
product of vertical axis with the gyroscope rotation vector. Therefore the rate of 
the rotation of the aircraft around the earthÕs y can be obtained by calculating 
? r + ? r + ? r 
x zx y zy z zz.
 
In other words, assuming the DCM is updated by the gyroscope, accelerometer and 
magnetometer sensors correctly, the following matrix is computed: 
 

   
  Equation 6  
   
 
Hence, the current orientation angles can be determined as: 
 
? ROLL =  atan2(  ,  ); 
? PITCH =  -asin(Gravity); 
? YAW =  atan2(  ,	 ); 
Stefanos Constantinou, Advanced Microelectronic Systems Engineering, 2011   19 
 

     
 2.4..2.1 Gyroscopes 
 
Gyr roscopes ar re required for the atttitude calcu ulation as tthey provid de angular velocity 
mea asurements.. However, the require ed paramete ers are the tthree angles s (roll, pitch h, yaw), 
hen nce an integration on the measu ured angula ar velocities must be performed d [7]. A 
prob blem which h arises is t that MEMS S IMUs are following the vehicle e (they do n not have 
mov ving parts a as traditiona al gyroscop pes) and pro oduce signa als proportio onal to the rotation 
rate e, hence th here is no change on the rotatio on. The sollution to th his problem m is the 
calc culation of the sequen nce of rotattiions. Thus,, the gyrosc copes can p provide the desired 
data a to the DCM. 
As men ntioned bef fore, these s sensors are not accuratte in readin ngs and con nsidering 
the required in ntegration, a an error mig ght grow to o infinity. T That is know wn as drift [7] .The 
solu ution to this s is the recognition of tthese errors and the app plication of f adjustment ts before 
the DCM is co onstructed. T These adjus stments can be made by y the use of f a PI (propo ortional-
inte egral) contr roller and th he use of r reference vectors. This s controller r provides n negative 
feed dback to a drift adjust tment unit ensuring th he DCM would be acc curate as sh hown in 
Figuure 7. The e most com mmon tech hnologies a are used to o connect gyroscopes s to the 
2
processing unit t are the Int ter-Integrate ed Circuit (I I C) and the e analogue iinterfaces. 
 
 
F Figure 7: Oriientation calc culation procedure 
2.4..2.2 Triax xial Acceler rometers 
 
Acc celerometer rs provide m measuremen nts of inertia al forces and gravity. H Hence, the d direction 
of g gravity can n be determ mined.  Thu us, it provid des orientatiion measur rements con ntrary to 
gyr roscopes which provid de the cha ange to orientation. T Thankfully,, any error r in the 
acceleration m measuremen nts is not as crucial as in th he gyrosco opes because each 
mea asurement i is not affected by the pr revious one e. 
 As a re esult, the ro ole of the ac cceleromete ers on such vehicles is s to provide e the roll 
and d pitch error correction ns of the gy yroscopes d drift [8]. Th hat is becau use the airc craft has 
con nstant forwa ard speed an nd does not accelerate f frequently, h however, an ny instabilit ty in roll 
or p pitch is mea asured. Acc celerometers s provide th he reference e vector Z f for the gyro oscopeÕs 
Stef fanos Constantinou, Advanc ced Microelec ctronic System ms Engineering g, 2011  20 
 drif ft correction n. Again, co ommon inte erfaces for connecting MEMS acc celerometer rs to the 
com mputational unit are the e I2C and th he analogue interfaces.
2.4.3 Positio oning System m 
 
The e most pop pular positio oning system m is the G Global Posittioning Sys stem (GPS) ). It is a 
sate ellite-based system tha at makes use e of 24 sate ellites in order to prov vide accurate (about 
3m deviation) positioning g informatiion. This in nformation can be use ed as the re eference 
vec ctor for yaw w. Hence, th he yaw orien ntation of th he model is enhanced w while it can ncels out 
the gyroscope drift. The reason the G GPS cannot be the only y sensor for yaw calculations is 
its l low update rate which h is normallly y at about 1-4Hz (upd date: GPS re eceivers wi ith 10Hz 
upd date rate we ere released d in the ma arket for civ vilian needs s at low cosst after this s project 
star rted)The GP PS receiver rs provide information n such as llongitude, llatitude, speed and 
cou urse over gr round and altitude. Th he course o over ground d is defined d as the cl lockwise 
ang gle from nor rth to direction vector.   
 The wa ay to obtain n informatio on from a G GPS receive er is the NM MEA (0183) format 
[10]. This form mat is a hu uman reada able standar rd ASCII e encodes dellimited by commas 
(Ò,Ó Ó). The inter rface of con nnecting suc ch a device t to a process sing unit is u usually the UART. 
. 
2.4..3.1 NME EA 0183 
 
NM MEA is the abbreviatio on word of N National M Marine Electtronic Asso ociation [10]. It is a 
com mmunication n serial pr rotocol tha at GPS de evices are using to exchange position 
info ormation. T This exchan nge is don ne via wel ll-formed s sentences. TThe senten nces are 
cha aracterised b by the Ô$Õ(d dollar sign) at the start of the sente ence and en nd with a ch hecksum 
of a a Ô*Õ (star) a and two hex xadecimal n numbers (ex x. *4F) follo owed by <C CR><LF> (C Carriage 
Ret turn and a L Line Feed). 
There a are several t types of NM MEA senten nces availab ble on GPS receivers, h however 
not all of them m are provid ding the requ uired inform mation for U UAVs auton nomous nav vigation. 
Use eful sentenc ces for aut tonomous n navigation are usually y those the ey provide at first 
pos sitioning inf formation, fix quality,, number of f satellites connected, altitude ab bove sea 
leve el, speed ov ver ground a and course o over ground d. 
Unfortu unately, this informatiion cannot be extracte ed from a s single sente ence but 
from m two. The ese are the GPGGA w which provid des all the above inforrmation apa art from 
speed and cour rse over gro ound. Such d data are ava ailable in th he GPRMC sentence. A A sample 
sent tence is ana alysed in Ta able 2. 
  
Stef fanos Constantinou, Advanc ced Microelec ctronic System ms Engineering g, 2011  21 
  
Table 2: Sample NMEA sentence [11] 
Sentence sample $GPGGA, 170834, 4124.8963, N, 08151.6838, W,1,5,1.5, 280.2, M, -34.0, M,, *75 
Name  Example Data  Description 
Sentence Identifier  $GPGGA  Global Positioning System Fix Data 
Time  170834 17:08:34 Z 
Latitude  4124.8963, N  41d 24.8963' N or 41d 24' 54" N 
Longitude  08151.6838, W  81d 51.6838' W or 81d 51' 41" W 
Fix Quality: 
Data is from a GPS fix. Fix term is 
0 = Invalid assures that the positioning 
1 
1 = GPS fix information are correct (accurate 
enough for navigation).  
2 = DGPS fix 
Number of Satellites  5 5 Satellites are in view 
Relative accuracy of horizontal 
Horizontal Dilution of Precision (HDOP) 1.5 
position 
Altitude  280.2, M  280.2 meters above mean sea level 
Height of geoid above WGS84 ellipsoid  -34.0, M  -34.0 meters 
Time since last DGPS update  blank  No last update 
DGPS reference station id  blank  No station id 
Used by program to check for 
Checksum *75 
transmission errors 
 
2.4.3.1.1 NMEA Checksum Calculation/Validation 
 
The way the NMEA sentences are checked against corruptions is the checksum value at 
the end of each sentence. The algorithm for validating the sentences is by performing an 
XOR between all bytes which exist between the Ô$Õ sign and the Ô*Õ sign. 
 
A sample C code for calculating the checksum is: 
 
int CheckSum(char *sentence) { 
int i; 
int res=0; 
int c; 
 for (i = 0; i < strlen(string); i++) { 
  c = (unsigned char)string[i]; 
  if (c == '*') break; 
  if (c != '$') res ^= c; 
 } 
return res; 
} 
  
Stefanos Constantinou, Advanced Microelectronic Systems Engineering, 2011   22 
 2.4.4 Magne etometers 
 
Magnetometer rs can sense e the earth hÕs magnetic field. Wh hile they a arre not plac ced near 
mag gnetic field d isolators, their measu ures are ac ccurate enou ugh to prov vide the las st bit of 
info ormation re equired for the attitude e calculation while the e craft is ho overing. Th hatÕs the 
yaw w angle, wh hich can be determined d by measur ring the ma agnetic field d in the bod dy of the 
airc craft. In ad ddition, afte er a GPS siignal failur re, magneto ometers can n still navigate the 
airc craft until th he signal is r recovered.
 
2.4.5 Collisio on/Obstacl le Avoidanc ce 
 
In the field of autono omous UA AVs, sever ral technollogies hav ve been used for 
coll lision/obsta acle avoidan nce. The mo ost accurate e approach is the obsta acle detectio on using 
com mputer visio on and imag ge processin ng technique es [12].  
Althoug gh it is an accurate so olution for o obstacles de etection and d avoidance e, such a 
solu ution increa ases dramat tically the w weight and the size of f the UAV as well as its cost. 
Con nsequently the flight ti ime is redu uced by a lo ot. This approach is oft ften used for indoor 
auto onomous ve ehicles to bu uild a routin ng map or o on medium to large siz zed UAVs. T The way 
they y work is by y using ster reo vision o or 3D camer ras to detectt near objec cts. Both tec chniques 
are measuring distances by analysing g video fram mes. 
Anothe er solution f for obstacle e avoidance e is the use e of range-f finder senso ors [13]. 
Two common types of t these senso ors which c can be used d are sonar r range-find ders and 
infr rared range- -finders. Th heir advanta age over vis sion obstaclle detection n is their sm mall size, 
wei ight and their low cos st. Furtherm more they d do not requ uire any co omputation on their 
outp put for obs serving the distance be etween them m and the o obstacle. Su uch devices s can be 
2
con nnected on a a microcontroller via th he I C or an nalogue inpu ut interface.   
 
2.4.6 Barom meters 
 
Bar rometers are e sensors fo or sensing tth he atmosph heric pressu ure. Their m main role on n a UAV 
is f for altitude e calculation n, which iis much mo ore accuratte than the e GPS estim mations. 
Alti itude measu urement on n an aircraftt is required d to be tran nsferred to the ground d control 
stat tion for mission plannin ng. Furtherm more, it is r required for the aircraftt in order to o hold its 
altit tude. In ad ddition, a b barometer p provides me easurements in Pascall units. Hence, the 
foll lowing form mula should be applied for altitude calculation n in meters: 
 
-5 5.25588
p = 1013325 (1 - 22.25577 100 h) 
Where  
p = air pressure (in Pa) 
h = altitude abovve sea levvel (m) 
Stef fanos Constantinou, Advanc ced Microelec ctronic System ms Engineering g, 2011  23 
 2.4.7 Electro onic Speed Controller rs and Motors 
 
Mo otors are com mmonly used on smalll aerial mod dels, are us sually the b brrushless ou ut runner 
mot tors. Contra ary to the tr raditional m motors, the power is no ot applied o on the shaft t, but on 
the coils. An e electronic ci ircuit called d ESC is re esponsible to apply the e power to t the coils 
for the genera ation of the e magnetic  field. As soon as th he magnets  and the shaft are 
perm manently a attached on the drum, the whole drum is rottating elimiinating frict tion and 
eros sion. 
 The ter rm ESC stands for Ele ectronic Spe eed Controller. It is a c circuit that has as a 
high h power so ource as inp put and the brushless m motors as o output. The e amount of f energy 
tran nsfers from the input source to the e motors is controlled by a Pulse--Width Modulation 
inpu ut. That str ructure is used for con ntrolling hig gh power consumption n motors th hrough a 
low w powered c circuit such as a microc controller or r a micropro ocessor. 
 
2.4.8 Sensor r Interfacing n 
 
Fou ur main type es of interfa acing are av vailable for connecting sensors to tthe processing unit. 
The ese are the PWM for t the DC roto ors, UART for GPS signal receiv vers, analogu ue input 
2
and d I C protoc col for the g gyroscopes, accelerome eters, magne etometers a and ultrason nic range 
find ders. 
 
 
2.4..8.1 Pulse e-Width Mo odulation 	
 
PW WM is a digital method of c controlling analogue circuits [1 14]. Most of the 
mic crocontrolle ers and DSP Ps feature th his technolo ogy making the implem mentation ea asy. The 
way y it works is s by splittin ng the duty cycle of a s square wave e into desire ed-size mod dules. At 
any y time of t the output signal a diigital value e is observe ed, howeve er due to t the high 
swi itching spee ed, the overa all output v voltage signal forwarde ed to the inp put of the an nalogue-
in d device is se eemed as an nalogue. Fig gure 8 illus strates the P PWM metho od for a 10 0%, 50% 
and d 90% out tput of the e DC supp ply. For in nstance, if the opera ating voltag ge of a 
mic crocontrolle er is 5V, the e output of f the PWM would be 0 0.5V, 2.5V for the second and 
4.5V V for the third. The resolution of the out tput depend ds on the a architecture e of the 
emb bedded syst tem is in use e. 
 
Stef fanos Constantinou, Advanc ced Microelec ctronic System ms Engineering g, 2011  24 
  
Figu ure 8: PWM o operation 
 
2
2.4..8.2 I C (I Inter-Integ grated Circuit) 
 
2 2
I C  bus offers the opportu unity of inte erfacing up t to 112 devices. Accord ding to [15], the I C 
7
has  7 bits of ad ddress space (2 =128) where 16 o of them are reserved. Itt has 2 bidir rectional 
2
line es, the SCL L (serial clock) and SD DA (serial d data line). T The advanta age of I C b bus over 
the analogue i input is tha at it deliver rs analogue e informatio on in a dig gital manner r, hence 
2
inte erfacing dev vices that a accuracy m matters. I C ensures a n noise-free ttransmission n to the 
desttination. Ev very device e connected d on the bu us has a un nique addresss and can operate 
eith her as a rece eiver or a tr ransmitter. That addres ss has to be e used in or rder to a dev vice can 
com mmunicate w with anothe er device. F Figure 9 illu ustrates the e required c connection b between 
the devices. 
 
 
Figure 9: I2C bus w with 2 devices
 
Com mmunicatio on procedure e: 
? The ma aster ensures the bus is free (Both lines are high) 
? The ma aster sets the e SDA line to low and then sends the receive er r address 
Stef fanos Constantinou, Advanc ced Microelec ctronic System ms Engineering g, 2011  25 
 ? The Read/Write request bit is sent after the 7 bit address 
th
? Slave recognizes its address and acknowledges by setting SDA low at the 9 SCL 
cycle. 
? The data is sent 
? Acknowledgement is sent 
? When SCL is high and SDA has a rising edge the stop condition is indicated. 
 
2.5.  Wireless Communication 
 
Most common types of communication media found on small UAVs are the wireless 
802.11x and RF technologies [16]. These types of communication provide a high rate of 
data transfer as well as reliability in terms of successful transmit/receive of data. As the 
payload of the UAVs is limited, the communication equipment they can carry has to be 
limited in weight; as a result the effective range of communication between the ground 
control stations is restricted to several miles.  
 The communication between the UAV and the ground control station has to be 
bidirectional. The ground station is sending navigation orders while the vehicle is sending 
flight data back to the ground station. For this reason wireless communication media are 
used such as Wi-Fi which features the reliable TCP/IP protocol [16]. 
Another wireless communication media is the GPRS/3G which is a GSM service 
[17]. It uses the GSM cellular network to exchange reliable data using TCP/IP transport 
layer protocol. All well-known application layer protocols such as HTTP, POP3, FTP etc. 
are working on top of it. 
  
Stefanos Constantinou, Advanced Microelectronic Systems Engineering, 2011   26 
 3.  THEO ORETICA AL BACK KGROUN ND ON GCS 
 
As UAVs are b built to exe ecute missio ons, a groun nd control station is req quired for r real time 
con ntrol comma ands on flig ght directio ons and on camera rotations. As tthe UAVs offering 
auto onomous flights, the G GCS should provide all l the inform mation can b be found in manned 
air v vehicles as well as an i interface for r: 
? Configu uration of th he UAVÕs m missions 
? Real tim me tracking g of the vehiicle over the e globe 
? Monito oring instrum mentation a an nd status of f flight 
? FPV (fi first person v view) live v video stream ming 
? Mission n alterations and correc ctions 
? Aircraf ft initialisati ion procedu ures 
 
 
 
Figure 10: st tructured com mponents app proach of a G GCS software e [18]. 
 
The e software system con ntinuously receives ra aw data fro om the air rcraft. This data is 
processed by different un nits on the e system to o generate a a visual rep presentation n of the 
airc craftÕs state. The raw p positioning data are ada d pted in a w way to prov vide real tim me route 
trac cking and o orientation. Furthermo ore, the me easurements s of the air rcraftÕs sen nsors are 
con nverted to an n artificial h horizon whe ere the oper rator has a n notion of th he flying sta ate of the 
UA AV. Apart fr rom that, th he graphicall interface p provides mo onitoring of f the aircraf ftÕs vital 
com mponents fo or any failur re avoidance e via the art tificial instru umentation n. 
  
Stef fanos Constantinou, Advanc ced Microelec ctronic System ms Engineering g, 2011  27 
 3.1 Tasks and Instrumentation of a Ground Control Station 
 
The user should be able to plan a mission by specifying the coordinates of each 
destination as well as the priority of each. The system is also responsible to perform the 
pre-flight checks before proceeding to the take-off action [18]. During the flight the user 
is monitoring the aircraftÕs orientation as well as the mission progress. That is achieved 
soon as the GCS is continuously transforms the data are coming from the UAV to 
artificial instruments. This instrumentation helps a user to have notion of the flight status.  
The main instruments should exist on a ground control station are: 
? Real time GPS Information 
? Altimeter 
? Artificial horizon / Head-Up Display (HUD) is shown in Figure 11 
? Battery/Fuel status 
? Speed over ground 
? Air speed 
 
Figure 11: A sample HUD for visualization of flight data [19] 
The GPS information are available within a GCS is used for the determination of the 
current position of the aircraft with respect to its destination. Hence, the UAV can be 
tracked on a map. The HUD displayed in Figure 11 is used for the determination of 
aircraftÕs orientation. This information combined with the current positioning information 
Stefanos Constantinou, Advanced Microelectronic Systems Engineering, 2011   28 
 help p the user t to inspect th he trajectory y of the UA AV. Further rmore, infor rmation suc ch as the 
altit tude, speed and fuel are shown 
3.2 Missio on plannin ng and nav vigation ov verview 
 
The e GCS is re esponsible f for the miss sion monito oring and planning. It should provide the 
userr with a v virtual glob be to plan the desire ed missions s. After th he user selects the 
desttinations of f interest, th he software e should ca alculate the routes and estimate th he flight 
time. Through h the flight the user ca an amend a any mission n or directio on deviation n as the 
curr rent position n of the airc craft is know wn. 
 
 
3.3 Comm munication n 
 
A c communication protoc col must be e agreed be etween the UAV and the ground d control 
stat tion. The in nformation t to be sent c consists of t two types, the main an nd secondar ry flight 
info ormation. A A dedicated mechanism m receives a and handles s that inform mation in re eal time. 
The e data acqu uisition un nit is respo onsible to p process the e informatiion and tra ansfer it 
mod dularized to o the respective units to perform m the visual presentatio on. A samp ple well-
form med messag ge is shown in Figure 1 12 [18]. 
 
 
Figure 1 12: Sample p packet format t 
Stef fanos Constantinou, Advanc ced Microelec ctronic System ms Engineering g, 2011  29 
 The information sent from the aircraft has to be encoded in a packet. This packet should 
have an overhead containing a Ôstart-of-messageÕ field, Ôthe packet lengthÕ and ÔtypeÕ. 
Then the significant information follows depending on type: 
 
? Main flight information: 
 
a. GPS position 
b. Speed over ground 
c. Course over ground 
d. Altitude 
e. Compass measurement 
f. Horizon information 
 
? Secondary flight information 
 
g. Battery level 
h. Number of GPS satellites connected to 
i. GPS signal lock indication (GPS fix) 
 
Apart from that, the GCS provides video streaming for surveillance. The streaming 
information might be sent either through the communication link or by a dedicated 
remote long-distance surveillance unit. In both cases, the GCS is responsible to combine 
the video information with artificial instrumentation discussed in chapter 3.1 Tasks 
and Instrumentation of a Ground Control Station. 
  
Stefanos Constantinou, Advanced Microelectronic Systems Engineering, 2011   30 
 4. IMPL LEMENTATION 
 
As stated abov ve, the work k made is d divided into o two parts. The work made on th he UAV 
and d the creatio on of the GC CS software e. The sub c chapter 4.1 is dedicate ed to the des sign and 
imp plementation n of the UA AV while su ub chapter 4 4.2 to the development o of the GCS. 
 
4.1. UAV D Design - H Hardware
 
The e UAV des sign is furth her divided d into two main parts s: the hardw ware design n of the 
airc craft and th he software integration n of the current code to meet thee objective es of the 
proj ject. For t the hardwar re part, a PCB desig gned to intterface all the electri ical and 
elec ctronic com mponents req quired. Ther refore, the e existing sof ftware of the e remote co ontrolled 
qua ad copter int tegrated to m meet the ob bjectives of the project listed in sub b chapter 1..1.1.  
 
4.1.1 Frame design 
 
The fra ame of the U UAV is desiigned by fo ollowing the e guidelines s of the open n source 
qua ad rotor heli icopter [1]. Its setup se elected to b be medium sized as it o offers stabil lity over 
win nd, further p payload cap pabilities an nd long fligh ht times. Its s final weig ght is 1.8 kg g and its 
flig ght time is b between 17-25 minute es. The time e variation depends on n the flying altitude 
and d the wind a as both varia ables affect the power c consumption of the mo otors.  
 
4.1.2 Hardw ware/PCB d design 
 
The PCB d design and implementtation was a result of studying tth he sensors and the 
com mputational unit of the quad rotorÕs architectu ure mentioned before. F For the intro oduction 
of new electr ronic comp ponents to enable the e internet c connectivity y and auto onomous 
nav vigation, the e following microcontro oller specifi fications wer re considere ed [20]: 
 
? 8-bit AVR RIS SC-based 
? Flash memory: 256Kb 
? Clo ock: 16MHz z 
? I/O pins: 86 
2
? I C protocol  
? UA ARTs: 4 
? AD DC channels s: 16 (10 bitts resolution n) 
? SRA AM: 8Kb 
? EEP PROM: 4Kb K 
? PW WM pins: 15 (8bit resolu ution) 
Stef fanos Constantinou, Advanc ced Microelec ctronic System ms Engineering g, 2011  31 
 Figu ure 13 show ws the block k diagram o of the PCB design. Th he sensors, G GPS/GPRS module 
and d RC receiv ver are the inputs to the e system while the ESCs and som me indicatin ng LEDs 
are its output.. The ESC Cs are conn nected with h the micro ocontroller through the PWM 
prot tocol. These are respon nsible to driive the high h power mottors as desc cribed in the e chapter 
2.4..7.  
 
 
 
Figure 1 13: Control B Block diagram m 
Based on t these specif fications, a new PCB w was designed and imp plemented f featuring 
all the sensor rs were alr ready supp ported by t the softwar re but wha at is more, a new 
GPS S/GPRS mo odule. This s adds to th he system th he required d resources for the UA AV-GCS 
com mmunication n as well as s positionin ng informati ion for auto onomous na avigation. Fi igure 14 
sho ows the eva aluation bo oard used aas computa ational unitt. As show wn, it inclu udes the 
mic crocontrolle er chip as well as circuits fo or wired communicattion. Most of the 
specifications m mentioned a above are a also visible o on the figur re.  
 
Figure 14: M Microcontrolller board use ed as comput tational unit [ [21]. 
Stef fanos Constantinou, Advanc ced Microelec ctronic System ms Engineering g, 2011  32 
 4.1..2.1 Senso ors Overvie ew 
 
Figuure 15 sho ows all the e sensors u used for th he impleme entation of the IMU and the 
com mmunication n link. By using thes se sensors, the first ta ask to keep p the price e low is 
ach hieved. All the sensors s apart from m the GPS/ /GPRS mod dule were iinterfaced w with the 
2
mic crocontrolle er using the e I C protoc col. For the e GPS/GPR RS module interfacing, UART 
com mmunication n protocol w was used.  
Gyrosc cope Acc celerometer
Magneto ometer Bar rometer GPS/GPR RS 
 
Fig gure 15: Sens sors used 
? Gyrosc cope specific cations: 
o 3 axis measures (X, Y Y and Z) 
o 16 bit resol lution 
o Low Pass f filter 
o Low curren nt consumpttion (6.5mA A) 
o Power supp ply range: 2 2.1V Ð 3.6V V 
2
o I C interfac ce (400KHz z) 
 
? Acceler rometer spe ecifications:: 
o 3 axis measures (X, Y Y and Z) 
o Measure ra anges: ±1g, 1.5g, 2g, 3g g, 4g, 8g, 16 6g 
o 14-bit resolution 
2
o I C interfac ce  
o Power supp ply range: 1 1.2V - 3.6V
o Low curren nt consumpttion (0.65m mA) 
? Magnet tometer spe ecifications:: 
o 3 axis measures (X, Y Y and Z) 
2
o I C interfac ce  
o 12-bit resolution 
o Power supp ply range: 2 2.5V - 3.3V
 
? Barome eter specific cations: 
o Measuring range of 30 00 to 1100 h hPa 
2
o I C interfac ce  
o Power supp ply range: 1 1.8V - 3.6V
Stef fanos Constantinou, Advanc ced Microelec ctronic System ms Engineering g, 2011  33 
 o Pressure resolution readings: 19-bit 
o Temperature resolution readings: 16-bit 
 
? GPS/GPRS module specifications: 
o SiRF III High Sensitivity GPS Receiver 
o Embedded TCP/IP Stack 
o GPRS Class 10 
o AT commands for control 
o UART line for AT commands 
o UART line for NMEA data (dedicated GPS UART)  
 
 
Figure 16: The new PCB designed 
The layout of the new PCB (Appendix chapter 9.2) is shown in Figure 16. It fits on top 
(orange rectangles) of the microcontroller shown in Figure 14 interconnecting all the 
sensors shown by different colour rectangles with the microcontroller. The cyan shape 
shows the power supply designed for powering the GPS/GPRS module which works on 
different voltage levels compared to the sensors and the microcontroller. 
 All the remaining sensors (barometer, accelerometer, gyroscope, magnetometer), 
2
are connected to the microcontroller using the I C interface. The way the protocol works 
Stefanos Constantinou, Advanced Microelectronic Systems Engineering, 2011   34 
 is d described in n the theoret tical backgr round 2.4.8..2 [15]. The e GPS/GPR RS (red recta angle) is 
con nnected with h microcont troller using g UART interface after the approp priate volta age level 
con nversions ap pplied. The schematic of the PCB B design detailing all tthe work do one with 
hard dware PCB design is in ncluded as a appendix. 
 The RC C receiver is connecteed through the analog gue pins sh hown in de eep blue 
rect tangle while the ESCs s are connected on the e PWM pin ns shown in n black rectangle to 
driv ve the motors. 
 
4.1.3 The UA AV Assemb bled 
 
 
 
 
Figure e 17: The UAV V assembled
Figu ure 17 is a an image o of the UAV V model im mplemented. It shows how the h hardware 
com mponents ar re interconn nected. The e battery ins stalled is a 5Ah Lithiu um Polymer r battery 
able e to provide e up to 100 0A current tto the moto ors. It voltag ge is 11.1V V. It also po owers up 
Stef fanos Constantinou, Advanc ced Microelec ctronic System ms Engineering g, 2011  35 
 the control circuit. The ESCs inputs are the battery and the PWM outputs of the 
microcontroller. Their outputs are connected to the motors as shown in the Figure 13 
block diagram. The Control circuit is divided into two levels. The microcontroller 
evaluation board is installed at the bottom while the PCB with the required sensors is 
attached on top of it. The GPS antenna is installed on the top of the cover as it requires 
light-of-sight view with the sky for better signal reception. The GSM antenna is mounted 
as far as possible form the electronic components because various tests showed that 
interferes with a sensor. Last but not least, the USB port mentioned provides access to the 
microcontroller for programming, debugging but what is more, wired connectivity with 
the GCS for pre-flight configuration and wireless communication initialisation. 
4.2 The UAV Software 
 
The software of the UAV developed performs two tasks. At first, it enables the vehicle to 
navigate itself (autopilot) while the same time enables wireless connectivity with the 
GCS platform through internet.  
 
 
Figure 18: The Block diagram of the open source software already exists [1] 
Figure 18 represents the structure of the software the quad rotor vehicle use for the RC 
navigation [1]. After the study of the software, several observations were made about the 
navigation control lead to the solution approach: 
 
? There is a DCM filled with data of all sensors as described in ÒTheoretical 
background on UAVsÓ chapter 2.4.2. 
? There is a PID controller for each angle of the aircraft dynamics (pitch, roll and 
yaw).  
Stefanos Constantinou, Advanced Microelectronic Systems Engineering, 2011   36 
 ? A PID controller update function exists which takes three parameters to update 
the aircraftÕs orientation: the Òset pointÓ, the Òcurrent dataÓ and a pointer to the 
object describing each angle (this object contains information such as P, I, and D 
gain parameters described in chapter 2.3.1). 
? The Òset pointÓ of each PID controller is the transmitterÕs input. 
? The Òcurrent dataÓ of each PID controller can be maintained by the DCM: 
o For the ROLL =  atan2(  ,  ); 
o For the PITCH =  -asin(Gravity); 
o For the YAW =  atan2(  ,	 ); 
? There is a function takes the PID controllersÕ output and generates motor 
commands. 
? The control loop runs at 100Hz (10ms update rate). 
 
The following statement is an abstract approach of what made for the autonomous 
navigation of the aircraft: 
 
The ideal algorithm for autonomous navigation should use the GPS data and the 
magnetometer readings in a way imitating the transmitter inputs which are currently 
assumed by the software as Òset pointsÓ for the three PID controllers already exist. 
 
Hence, an abstract block diagram of the modified flight software is presented in Figure 
19. The data are sent to the internet, as shown will be delivered to the GCS for 
processing. The procedure is discussed in chapter 4.3. 
 
Figure 19: The block diagram of the flight software after integration 
Stefanos Constantinou, Advanced Microelectronic Systems Engineering, 2011   37 
 4.2.1 Autopi ilot Algorit thm Approach 
 
  
As soon as t the GPS h has measura able output t (position coordinate es), two ne ew PID 
con ntrollers we ere applied in a way ttheir output t being the Òset pointÓÓ of the th hree PID 
con ntrollers alr ready used by the cu urrent softw ware (trans smitter nav vigation) [2 22]. The 
solu ution approa ach is illustrated in Fig gure 20. 
 
 
 
Fig i ure 20: Bloc ck diagram o of solution ap pproach 
 
As stated in t the chapter 2.4.3, the GPS lacks s of low update rate. Thus, the GPS is 
imp possible to navigate t the UAV b by itself, especially w when taking g into acco ount the 
inac ccuracy of the position ning data it t provides w which is abo out 3-4 metters of devi iation or 
wor rse.  
 For this reason the e autopilot algorithm u uses the ma agnetometer r (compass) ) for the 
auto onomous na avigation. I In summary y, the way i it works is by calculatting the ang gle from 
the current pos sition to the destination n using the c current GPS S data. As th he destination is set 
by t the user and d the curren nt position is s refreshed every secon nd, the anglle to destina ation can 
be o observed. A Another par rameter is th he azimuth,, which can n be also de etermined u using the 
mag gnetometer.. Once the required an ngles are c calculated, tthe native P PID controllers are 
upd dated to con nvert the req quired angle es to motor commands. 
 The first integratio on made on n the current t open source software e is the introd o uction 
of t two new PI ID controlle ers, one for r the pitch a axis and the e other for tthe roll axis angles 
ded dicated to th he autonom mous naviga ation. The o output of th hese two co on ntrollers is the Ôset 
poin ntÕ of the P PID controllers used to o navigate t the vehicle by the tran nsmitter. Fo or safety 
reas sons, the tw wo outputs a are summed d up with th he transmitterÕs comma and. As soo on as the 
tran nsmitter is not used (idle), the aircraft w will be nav vigated by the GPS and the 
mag gnetometer.. Furthermo ore, this app proach gives s immediate e manual co ontrol to the e UAVÕs 
orie entation as soon as the e transmitte er command ds overcome the comm mands gener rated by 
the autonomo ous navigat tion algoritthm. To e ensure that the transm mitter can always 
ove ercome the e algorithm mÕs comma ands for safety reas sons, the algorithmÕs value 
Stef fanos Constantinou, Advanc ced Microelec ctronic System ms Engineering g, 2011  38 
 gen nerations are e constraine ed to naviga ate the vehic cle very slowly (about 11 km/h) w while the 
tran nsmitter can n navigate it t at about 30 0-35 km/h.
NOR RTH 
Destina ation 
?
?
 
Fig i ure 21: Illu ustration of th he PIDÕs Òset pointÓ 
 
Con nsequently, the flight c control algo orithm has two roles. It has to pr rovide the r required 
para ameters for r the PID c controllers u update (Ôset t pointÕ and d Ôcurrent d dataÕ) as we ell as to 
che eck if the de estination is s reached. F For the calc culation of tthe Ôset poin ntÕ, two par rameters 
are required. T The first par rameter obs served is the azimuth, which is th he ? angle in n Figure 
21. That is basically a nu umeric valu ue in degree es of the de eviation of f the aircraft f Õs front 
proj jection to t the EarthÕs North. Thiis can be ea asily mainta ained by re equesting a reading 
from m the magn netometer (w which the m magnetomet ter chipÕs Ôf frontÕ is ma atched the a aircraftÕs 
Òfro ontÓ). The s second param meter requiired is the G GPS course, which is th he ? angle in n Figure 
21. That is the e clockwise e angle betw ween the di irection vec ctor of the a aircraft and d EarthÕs 
     
nor rtth. That vec ctor is defin ned as  w where A is the currentt position co oordinates a and B is 
dest tination coo ordinates. 
Trig gonometry applies for the determiination of th his angle as follows: 
? Subtrac ction of the e last Longiitude data t the GPS ha as provided from desti inationÕs 
Longitu ude (Destin nationLongittude - Curr rentLongitude). The re esult should be then 
multipl lied by the constant 0 0.649876. T The multipllication con nverts the r result in 
centime eters as the e earth is an ellipsoi id object (W WGS84 elllipsoid para ameters) 
enablin ng the trigon nometry fun nctions to be e applied. 
? Subtrac ction of the e last Latitu ude data th he GPS has s provided from desti inationÕs 
Latitud de (Destina ationLatitud de - Curren ntLatitude). The resu ult should be then 
multipl lied by the constant 1 1.113195. T The multipllication con nverts the r result in 
Stef fanos Constantinou, Advanc ced Microelec ctronic System ms Engineering g, 2011  39 
 
centimeters as the earth is an ellipsoid object (WGS84 ellipsoid parameters) 
enabling the trigonometry functions to be applied. 
? The inverse tangent of the two differences results the angle to destination ( ? 
angle): ?=atan2(LongitudeDiff,LatitudeDiff). 
 
The subtraction ?- ? gives the Òtarget angleÓ which will be used as the Òset pointÓ for the 
PID controller updates (both pitch and roll) such as: 
 The sine of the target angle is the Òset pointÓ for the rollÕs PID controller while 
the cosine of the target angle is the Òset pointÓ of the pitchÕs PID controller.  
During the calculation of the Òset pointÓ, another variable calculated is the distance to 
destination. This is easily maintained by the use of the differences already calculated. The 
2 2 2
Pythagorean Theorem is applied for the distance calculation. c = a + b where ÔaÕ is the 
LongitudeDiff and ÔbÕ is the LatitudeDiff. 
As the Òset pointsÓ are determined, the Òcurrent dataÓ is the second parameter the PID 
controller requires. For the determination of this, two consecutive samples from the GPS 
data are required. This is the previous coordinate position (longitude, latitude) and the 
current position. A similar procedure is applied for the calculation as before: 
? Subtraction of the current Longitude read by GPS from the very previous 
Longitude read depending on the GPS rate (PreviousLongitude - 
CurrentLongitude). Note: for the Òcurrent dataÓ calculation the Previous 
Longitude is used instead of the destinationÕs Longitude.  
? Subtraction of the current Latitude read of GPS from the very previous Latitude 
read depending on the GPS rate (PreviousLatitude - CurrentLatitude). Note: for 
the Òcurrent dataÓ calculation the Previous Latitude is used instead of the 
destinationÕs Latitude.  
? The inverse tangent of the two differences is the trajectory deviation angle ( ? 
angle) which is effectively the error parameter of the PID controller: 
?=atan2(LongitudeDiff,LatitudeDiff) 
The subtraction ?- ? gives the Òtarget angleÓ will be used as the Òcurrent dataÓ for the PID 
controller updates (both pitch and roll). 
 What effectively is achieved here is the correction of the GPS deviation affecting 
the trajectory of the aircraft to the destination. This attempts to correct these errors 
because the calculation of the Òtarget angleÓ is a result of both GPS and magnetometer 
readings ( ?- ?, where ? is the azimuth obtained by the magnetometer). As the 
magnetometerÕs update rate is really high compared to the GPSÕs (100Hz versus 1Hz) the 
GPS errors are ÒsmoothedÓ by the PID controller because the magnetometer provides fast 
and accurate corrections.  
Stefanos Constantinou, Advanced Microelectronic Systems Engineering, 2011   40 
 NO ORTH 
? ?Õ
Destinatio on 
?Õ
?
?
 
Figure e 22: Autonom mous navigat tion PID cont troller effect 
Tha at procedur re is visual lized in Fig gure 22 wh here the bllue dotted line represents the 
trajectory the aircraft wo ould follow w if there were not a any correcttiions. The red line 
repr resents the correction b by the PID controller u using the magnetomete er readings. The red 
line e is the actual trajectory y the aircraf ft follows. 
 The fin nal check w which the algorithm performs is s if the de estination h has been 
reac ched. The destination is assumed d as reache ed if the cu urrent posittion of the GPS is 
with hin a radius s of about 2 20 meters a away from the actual d destination position se et by the 
user r. For the c calculation of this, the e parameter is checked d is the disttance to des stination 
com mpared to a a value of the square r root of 300(about 17.3 3 meters). I If the destin nation is 
reac ched then the algorit thm checks s if there is another position inn the miss sion list 
(positions). If t there is, then the same procedure a applies until all the pos sitions are reached. 
 Anothe er objective e achieved w which is re elated to the navigatio on algorithm m, is the 
pos sition hold. Once there are no mor re positions s in the list, the roll and d pitch Òset t pointsÓ 
are set to zero o. Due to th he inaccura acy of the G GPS, the aiircraft migh ht move ou ut the 20 
met ters of dest tination dev viation. The e distance w will then be ecome grea atter than the e square 
root t of 300 and d then the algorithm is enabled aga ain to bring g it back to tthe destinati ion. 
 Last bu ut not least t, one mor re objective e achieved is that the e autonomo ous fight 
soft tware is ind dependent of the comm munication link. Once th he user has  correctly u uploaded 
the position li ist (mission ns) before flight, the algorithm ensures tha at the aircr raft will 
Stef fanos Constantinou, Advanc ced Microelec ctronic System ms Engineering g, 2011  41 
 trav verse all the e positions. It will also o perform a position ho old (hoverin ng) on last p position. 
The e last positio on should be the base.
4.2.2 Serial c communica ation 
 
The e open sour rce software e of the qua ad copter fe eatures seria al communiication via t the USB 
por rtt. A comm mand set ex xists which h the micro ocontroller can under rstand and provide 
resp ponses. Suc ch responses are curren nt PWM mo otor values, sensor rea adings, RC receiver 
read dings et cet tera. These commands are used fo or the config guration of f the vehicle e for RC 
tran nsmitter flig ghts. It als so provides s responses s for debug gging and observation n of the 
curr rent motion n state of th he model. Through th he serial co ommunicatio on, the use er is can 
con nfigure the P P, I and D parameters s of the PID D controller rs as well a as calibrate the RC 
tran nsmitter and d the sensors.  
 This co ommand se et has been n extended. Further co ommands w were added for the 
inte ernet link in nitialization n and the d debugging o of the auton nomous nav vigation alg gorithm. 
For r the interne et link initia alization, the e command d set extend ded to allow w the system m to read 
the domain of f the GCS and the po ort listens o on. That in nformation is required d for the 
com mmunication n handler. T The extensiion made fo or the auton nomous nav vigation deb bugging, 
is th he introduc ction of new w command ds for presenting the G GPS receive erÕs data bu ut whatÕs 
mor re, to report t PID controllers outpu ut and their effect on m motors, as d described in n chapter 
4.2..1. 
 
4.2.3 Comm munication L Link Estab blishment 
 
Ano other integ gration mad de on the current sof ftware was the introd duction of internet 
con nnectivity. F For the achi ievement of f this object tive, three m main parts w were develo oped. At 
firstt, an interfa ace was dev veloped ena abling the m microcontro oller to com mmunicate w with the 
GPS S/GPRS m module. This also prov vides the r required iniitialisation and status checks. 
The en, a commu unication object settled d, providing g functions for internett link establ lishment 
and d informatio on exchang ge. Last bu ut not leas st, a new f frame loop p running a at lower 
freq quency than n the main loop runs w was developed e . Its respo onsibility is  to send the e current 
flig ght data and d receive an ny available e instruction ns coming from GCS.. That runs without 
affe ecting the st tability of th he flight and d makes use e of the com mmunication n object. 
 Howev ver the explanation fo ollows of e each part, iis in revers se order fo or better 
und derstanding.. It starts fr rom the mo ost abstract part which h is the low w frame loo op while 
end ds to the inte erface devel loped for th he microcon ntroller-GPS S/GPRS com mmunicatio on which 
is th he lowest le evel. 
 
  
Stef fanos Constantinou, Advanc ced Microelec ctronic System ms Engineering g, 2011  42 
 4.2..3.1 Embe edding com mmunicatio on feature in the main loop 
 
A o one-hertz lo oop frame in ntroduced tto handle da ata transmis ssion and re eception at a lower 
rate e than the co ontrol loop. There was s two reason ns for which h the comm mu unication could not 
be d done on hig gher frequen ncy. The fir rst reason w was to avoid overloads o on the buffe fer of the 
GPS S/GPRS mo odule. The o other reason n was the G GPS update r rate. As soo on as new da ata were 
ava ailable ever ry second, there wou uld be dupl licates by transmitting g at a fast ter rate. 
Fur rthermore, t the less processing spe ent on data transmissio on, the faste er the main n control 
loop p runs at.  
 The in ntroduction of the fram me loop w was quite easy proced dure as the current 
soft tware was a already usin ng a time v variable for r time notattion which is also req quired in 
vari ious calcula ations such as the PID c controllers.  
 The loop frame d developed w was placed d in a position ensuriing that the e sensor 
read dings are re ecent by the e time is exe ecuted. It th hen perform ms two tasks s. At first it encodes 
all t the sensor r readings in a message a and request ts a transmission from the commu unication 
han ndler. The e encoding pr rocess prod du uces a mes ssage simila ar to the on ne found in chapter 
3.3..  
Tha at message h has the follo owing fields s in order:
? Start o of message i indicator 
? Curren nt roll angle e 
? Curren nt pitch angl le 
? Curren nt GPS Latit tude 
? Curren nt GPS Long gitude 
? Numbe er of satellit tes in view
? GPS fi ix 
? GPS sp peed over g ground 
? Battery y monitor (f fuel) 
? Magne etic heading g (compass) ) 
? Altitud de above/be elow take-of ff position i in meters 
? End of f message in ndicator 
  
The e second tas sk it perform ms is a chec ck whether t there are an ny pending d data on the receiver 
buf ffer. In that c case, it requ uests decodiing from the communic cation hand dler. 
 
4.2..3.2 Comm munication n Handler
 
The e communi ication handler develo oped is the e most fun ndamental c component for the 
com mmunication n between t the UAV an nd the GCS S. It makes use of a G GP PS/GPRS o object to 
perf form the lin nk establishm ment and th he exchange e of informa ation.  
The e responsibi ilities of the e communic cation handl ler are: 
Stef fanos Constantinou, Advanc ced Microelec ctronic System ms Engineering g, 2011  43 
 ? Initiali isation of G GPS/GSM m module. 
? Comm munication li ink initialisation. 
? Recept tion/Transm mission of d data. 
? Data d decoding/parsing. 
? Missio on updating. 
 
For r the initiali ization of th he GPS/GP PRS module e, the comm munication h handler inst tantiates 
the communic cation obje ect. The co ommunicati ion handler r cooperate es with th he serial 
com mmunication n by using its capabilitties of read ding the GC CS domain iinformation n as well 
as t the port is l listening on n. By using g that inform mation, it provides to tthe commu unication 
obje ect the requ uired inform mation to iniitialize the internet com mmunication n link. 
 Anothe er main tas sk of the c communication handle er is the m management t of the 
bidi irectional I Internet dat ta link. It accepts re equests for data trans smission fr rom the 
com mmunication n loop disc cussed in c chapter 0 a and execute es them. In n the case of data 
rece eption is r requested fr from the m main loop, the handle erÕs responssibilities ar re more 
com mplex. At fi first perform ms the appro opriate checks to decide whether r the incoming data 
are a Òmission planÓ or a Òmission am mendmentÓ Ó. If a missio on plan mes ssage is rec ceived, it 
app pends it to the missio on list wher re the auto onomous na avigation a algorithm re eads the 
pos sitions to fl ly to one b by one. If a Òmission n amendme entÓ messag ge is receiv ved, the 
com mmunication n handler im mmediately replaces th he position tthe UAV is travelling t to, to the 
pos sition just re eceived from m the GCS.. The handler finally ac cknowledge es the GCS that has 
successfully re eceived the m mission me essage sent.
4.2..3.3 The C Communica ation Object 
 
The e GPS/GPR RS module p provides th he media of f Internet co onnectivity through the GPRS 
serv vice and th he TCP/IP stack; as a a result the first step was to ma ake these re esources 
ava ailable to t the microc controller. The GPS/G GPRS mod dule is co ontrollable via AT 
com mmands [23 3]. These co ommands a are sent to the UART line and th he module receives 
them m, decodes s them and finally exe ecutes them m. Hence an n object (cllass) describ bing the 
GPS S/GPRS mo odule was c created. Th hen, some m methods were construc cted to trans slate the 
mic crocontrolle er requests t to AT com mmands as w well as tran nsfer them to the UAR RT line. 
The ese method ds are also responsiblle for hand dling the responses o of the mod dule and 
repo orting them m back to the e microconttroller. 
The e interface d developed p provides the e following functionalitties to the m microcontrol ller: 
? Togglin ng on/off th he GPS/GPR RS module
? Initializ zation of the e module: 
o Configurat tion of the U UART comm munication baud rate. 
o Configurat tion of the N NMEA UAR RT commun nication bau ud rate. 
o Sets PIN co ode of the S SIM card. 
o Enabling/d disabling NM MEA senten nces for autonomous na avigation. 
Stef fanos Constantinou, Advanc ced Microelec ctronic System ms Engineering g, 2011  44 
 ? Perform m GSM con nnection. 
? Perform m GPRS initialization.
? Openin ng Internet c connection ( (socket dial l) to a specified host. 
 
Alm most every class in pro ogramming contains a constructor r. The comm municationÕ Õs object 
con nstructor is responsible e to define the baud r rates of both UART p ports as wel ll as the 
sele ection of the e NMEA se entences willl flow on th he GPS UA ART. It also  performs th he GSM 
con nnection, w which is required befo fore the GP PRS servic ce can be used. Fina ally, the 
com mmunication n object is r responsible to open the e network socket (conn nection to th he GCS) 
as s soon as the d domain nam me and port is given.  
 Using t this approac ch, what is achieved is s the indepe endence of connectivit ty errors 
with h the flight t loop (which is the m most vital co omponent). That is ach hieved beca ause the 
mic crocontrolle er instructs t the module to perform a task. The e control loo op does not wait for 
a re esponse, bu ut the respon nse waits to o be read. If f there is a failure with hin the mod dule and 
the microcontr roller receiv ves no resp ponse after certain tim me has elap psed, the module is 
rese et.  
 
4.3 GCS So olution app proach 
 
Since the UA AV assembl led, progra ammed to f fly autonom mously and d able to e establish 
inte ernet conne ectivity, an interface r required fo or the user to configu ure it and p plan the 
mis ssions. Henc ce, a GCS w was develop ped which p provides to a user an in nterface to o organize 
the flights. Th he software eÕs structur re is simila ar to the m modularized model app pears in 
cha apter 3. The e way it wor rks is by en ncoding the visual info ormation pro ovided by u user into 
mes ssages and then transm mits them u using the co ommunication link. On n the other hand, it 
dec codes the d data coming g back from m the UAV V and alloc cates them to the resp ponsible 
mod dules for visual represe entation.  
 The so oftware has three main n modes. T These are th he configur ration, the mission 
plan nner and th he flight da ata. The co onfiguration n mode pro ovides the ttools for th he wired 
con nnection an nd vehicle i initialisation ns. The mi ission planner mode is an interface for 
plan nning the fl flights of the e UAV and d the flight data mode is the visua al represent tation of 
the vehicleÕs in nstruments a as well as itt track on th he globe. 
 
4.3.1 Comm munication l link handle er 
 
The ere are essen ntially two communica ation handle ers in the GC CS software e, one for th he wired 
and d one for th he wireless connectivitty. The firs st it uses se erial protoc col to comm municate 
with h the UAV while the la atter uses th he Internet.
 
Stef fanos Constantinou, Advanc ced Microelec ctronic System ms Engineering g, 2011  45 
 4.3..1.1 Serial communi ication han ndler 
 
The e serial com mmunication n handler is s responsible for the managing the e data comi ing from 
the serial port (USB) form m the vehic cle and the d data are sen nt out to the e vehicle. A As it has 
bee en develope ed in an o object-orien nted progra amming lan nguage, it makes use e of the 
ava ailable libra aries to decode the me essages and d transform them to viisual objects. Such 
obje ects are the e HUD and motor sp peed indica ators. The c configuratio on tools for r sensor 
cali ibration and d internet co ommunicatiion initializ zations are a also sent to the vehicle e via the 
seri ial commun nication han ndler, just a after they ar re formed a according to o the comm mand set 
the serial comm munication 4.2.2 of the e vehicle un nderstands.
 
4.3..1.2 The I Internet Co ommunicat tion handle er 
 
Wh hile the seri ial commun nication han ndler is man nipulating tthe wired c communicat tion, the 
inte ernet comm munication h handler has a hardest ro ole. Contrar ry to the ser rial commu unication 
han ndler, the da ata coming from the U UAV via the e internet ar re asynchro onous. Furth hermore, 
on the serial p port there is s a hardwa arre buffer, s something d does not ex xist for the internet 
com mmunication n.  
 For thi is reason, a an asynchro onous socke et listener s server was developed. Once a 
clie ent (UAV) gets conne ected, an as synchronou us call back k worker (s similar to s software 
inte errupt) is cr reated. The e way it ha andles the a asynchronous data is by creating g a new 
thre ead each tim me a new byte is rec ceived. The e new byte is decoded d using the e UTF-8 
cha aracter set, and then ap ppended to a byte list. Every tim me a byte is s added, a c check is 
mad de which decides whether the bytte list conta ains a comp plete messa age. If a me essage is 
reco ognized, the en the usefu ful informattion are extr racted and a allocated to o the corresponding 
view ws for visua al representation. The b byte list is then reset to o handle the e next messa age.  
4.3.2 The Co onfiguratio on View 
 
The e configurat tion view of f the GCS p provides the e tools for tthe aircraft iinitializatio on. It has 
two o sub view ws: the visual view aand a com mmand line e console. It uses th he serial 
com mmunication n handler t to exchange e information with the UAV via a the comm mand set 
described in ch hapter 4.2.2.  
Wit thin the con nfiguration v view, the fo ollowing can n be achieve ed: 
? Commu unication w with the UAV V using the USB cable e 
? Initialis sation of the e GPS/GPR RS module 
o The GCS a at first instru ucts the UA AV to enable e the modulle 
o It supplies the domain n and the port is listenin ng informatiion (automa atically 
detected by y software iif there is in nternet conn nectivity by the time the e 
application n runs) 
Stef fanos Constantinou, Advanc ced Microelec ctronic System ms Engineering g, 2011  46 
 o Instructs the connection to the GSM service. 
o Instructs the Vehicle to connect via Internet 
? Observation of the mission plan is currently in the UAVÕs memory 
? Calibration at the level position (sensor calibration) 
? Clear the mission from memory 
? Read the data coming from GPS receiver 
? Read the pitch and roll values generated by the autonomous navigation algorithm  
? Read the P, I and D parameters of the autonomous navigation PID controllers 
? Set new P, I and D parameters for the autonomous navigation PID controllers 
 
There are of course many parameters one may configure using the serial communication, 
all the native commands of the quad rotor helicopter can be found in [1].  
 
Figure 23 is a screen capture of the configuration mode of the GCS in the visual view. It 
illustrates how the raw sensor data are converted to visual objects for better user 
interface. Furthermore, all the data flowing on the serial line can be viewed as logs in the 
Òdata consoleÓ tab of the configurator. 
Figure 23: The Configuration View of the GCS 
  
Stefanos Constantinou, Advanced Microelectronic Systems Engineering, 2011   47 
 4.3.3 The M Mission Plan nner View
 
The e Mission p planner view w of the GC CS is the en nvironment the user ca an plan the flight of 
the UAV. As s shown in Fi igure 24, the e user can e easily selectt the positio ons on the g globe for 
surv veillance. T These positi ions are app pended to t the mission n list appear r on the rig ght hand 
side e. The user has therefo ore the oppo ortunity to u upload them m to the UA AV either u using the 
wir red or wirele ess commun nication. Th he mission l list can also o be saved f for future up pload or 
mis ssion repeat.  
 For the e developme ent of missiion planner,, the Google e Maps .NE ET library u used [24] 
as i it features u useful functions for ex xtracting an nd importin ng informatiion to map p. It also 
prov vides functi ions for con nverting mo ouse position n to WGS84 4 coordinattes and vice versa. 
The e mission planner us ses both in nternet com mmunication and seriial commu unication 
han ndlers to exc change data a with the U UAV. 
 Last bu ut not least t, Òfind loc cationÓ functionality a added. This s helps the user to 
sear rch a count try, a town or even a s street address for easier e mission p planning pro ocedure. 
The e altitude m mode, which h is shown n as disable ed in Figure e 24, is a f functionality y of the 
mis ssion planne er to receiv ve altitude iinformation n provided b by Google Maps. This s can be 
used for future e work on t the project for altitude e prediction n. More dettails on this s can be 
foun nd in chapter 7. 
  
 
F Figure 24: M Mission planne er view of the e GCS 
Stef fanos Constantinou, Advanc ced Microelec ctronic System ms Engineering g, 2011  48 
 4.3.4 The Flight Data V View 
 
Thi is is the virt tual cockpit of the user r. It uses the e internet co onnection ha andler to ob btain the 
rece ent flight in nformation c coming from m the UAV V and illustra ates them. A As shown in n Figure 
25 t the vehicle is tracked on the map p. The curre ent flight da ata are show wn in the H HUD and 
GPS S details bo ox placed on n the left ha and. The inf formation sh hown are th he GPS infor rmation, 
the current roll l and pitch a angles as we ell as the al ltitude and m magnetic he eading. 
 Further rmore, through this viiew, the mi ission amen nd objectiv ve is achiev ved. The 
userr by right clicks a po osition on tth he map and then pres sses ÒFly h hereÓ, a me essage is 
gen nerated instr ructing the U UAV to cha ange it traje ectory. Fina ally, the flig ght data view keeps 
logs s of the flight in the Ò ÒRemote da ataÓ tab shown under the HUD. These data a can be 
saved for furth her analysis.  
 
 
Figure 25:  Flight data v view of the G GCS 
 
  
Stef fanos Constantinou, Advanc ced Microelec ctronic System ms Engineering g, 2011  49 
 5. RESU ULTS 
 
Thi is chapter is s dedicated t to the resultts obtained during the v verification n of the UAV VÕs 
syst tem functio onality. The following c components s were tested d: 
? Main lo oop execution time of tthe UAV 
? Autono omous navig gation algor rithm  
? Commu unication lin nk (both UA AV and GC CS) 
? GCS fu unctionality
 
5.1.  Testin ng the Con ntrol loop r rate 
 
One e of the ver ry first test ts were mad de was the observation n of the co ontrol loop rate. By 
intr roducing the new featu ures describ bed in the ÒUAV Sof ftwareÓ, fou und in chap pter 4.2, 
ther re was a ris sk that the s small Ð 16M MHz microc controller m might not be e able to ha andle the 
processing pow wer requirem ments. 
How wever, as s shown in F Figure 26 tthe results obtained p prove that tthere was not any 
noti iceable effe ect on the lo oop rate in a way to af ffect the ma ain loop. On n average, the loop 
time was incre eased by jus st 20 micros seconds wit th some pea aks of 300 m microseconds when 
ther re was data a transmissi ion from G GCS to the U UAV. Neve ertheless, th hat is not w worrying 
bec cause such t transmission ns are perfo ormed befor re the aircraft takes-of ff and rarely y during 
flig ght when a m mission is am mended.  
 
Figure 26: The Control loop ra ate before and d after the UA AV software iintegration 
Stef fanos Constantinou, Advanc ced Microelec ctronic System ms Engineering g, 2011  50 
 5.2.  Auton nomous Na avigation A Algorithm m Test 
 
Thi is chapter a analyses the e results of real tests m made in an open area f for the auto onomous 
nav vigation alg gorithm veri ification, ho owever the e propellers were not iinstalled fo or safety 
reas sons. The f first test ma ade was to check if th he autonom mous naviga ation algorit thm can 
gen nerate the c correct mot tor comma ands. For s simplicity, the north iis assumed d as the 
veh hicleÕs front t projection. Using the GCS, a po osition to th he east (with h respect to o vehicle 
fron nt) was loaded as mission. As m mentioned be efore, the U UAV requir res manual take-off 
befo fore it can start its autonomous n navigation process. Hence, using g the transm mitter, a 
thro ottle value w was set.  Fig gure 27 was captured ju ust after the throttle vallue was adjusted. It 
sho ows that all the motors are spinnin ng at the sa ame speed. T This is wha at expected because 
the throttle att tempts to g give the ve ehicle only the vertica al movemen nt. As soon n as the 
prop pellers were e taken off, what is sho own is that t the vehicle hovers at le evel position n. 
 
 
Figur re 27: The GP PS Navigatio on algorithm iis disabled 
Figu ure 28 was captured ju ust after the e autonomou us navigatio on algorithm m enabled. As soon 
as eeastern des stination wa as set, the motor spee eds of Òfro ont-leftÓ andd Òback-lef ftÓ were 
incr reased whil le the Òfront t-rightÓ and d Òback-righ htÓ speeds w were decrea ased. That i indicates 
that t the algorithm has co orrectly calc culated the roll and piitch angles.  The motor r speeds 
sho own in the f figure, attem mpt to prov vide a clock kwise roll an ngle to the vehicle to r reach its 
dest tination.  
Stef fanos Constantinou, Advanc ced Microelec ctronic System ms Engineering g, 2011  51 
  
Figure 28: The GPS Navigation algorithm is enabled 
Thus, the next test made was to bring the vehicle to the destination position and observe 
its response. This test was made to verify the position hold functionality of the algorithm 
as well as the determination of a reached position. When the vehicle placed to the 
destination, the response on the motors was remarkable. The motors Òfront-leftÓ and 
Òback-leftÓ decreased their speeds. However, all the motors were not spinning at the same 
speed. That is because the inaccuracy of the GPS. For the confirmation that the GPS 
inaccuracy has resulted this response, the vehicle moved eastern than the destination 
position. The results obtained were as expected. The Òfront-leftÓ and Òback-leftÓ motors 
decreased their speeds while the Òfront-rightÓ and Óback-rightÓ motor speeds were 
increased to bring it back to the destination. A drawback recognised is the low GPS rate. 
As soon as the navigation between positions operates correctly (which includes the 
magnetometer readings for the trajectory following), the main reason the destination is 
delayed to marked as reached is the GPS rate. 
 
Autonomous navigation algorithm result synopsis: 
? The autonomous navigation algorithm has proven to function correct as soon as it 
calculates the required roll and pitch angles 
? The position hold feature proven to work as it can hold the vehicle in a radius of 
about 15 meters to destination 
? There is lag of the algorithm for detecting immediately that the destination is 
reached. That is due to the low GPS refresh rate.    
Stefanos Constantinou, Advanced Microelectronic Systems Engineering, 2011   52 
 5.3.  Communication Link Tests 
 
The way the communication link verified was by testing each side individually for both 
inbound and outbound data transfer. At first, an infinite loop was created on the 
microcontroller board that was generating random data. The data was in the form of 
messages the GCS understands and presents. At the same time, the microcontroller was 
connected to the computer via the serial port (USB). The messages were sent through the 
internet (outbound network socket) connection were repeated on the serial 
communication link. A telnet client as well a serial line client was used to log both 
incoming transmissions. After certain time has elapsed, both log files were compared for 
any data misses or corrupts assuming as valid data the data received through the wired 
transmission. The results showed that every byte was sent over the internet were received 
correctly and in order. 
 For the inbound transmission verification, a similar concept applied. The 
difference was that the infinite loop on the microcontroller used to read from the internet 
link (network socket) and then repeat them to the serial line. The data received from the 
serial line were compared with the original data was sent from the computerÕs outbound 
internet connection. Again there were not any corruptions or data misses. Identical 
procedure applied to verify the GCS communication link. 
 After the individual verification tests were completed, the communication link 
was tested while the autonomous navigation algorithm was running. The serial 
communication kept active to validate the transferred mission plans and mission 
amendments. Succeed transmission of data was resulted. 
 However, tests showed that the GSM antenna interferes with a component is 
installed on the PCB. For this reason the antenna moved as far as possible from the 
electronics. 
  
5.4. GCS Functionality Tests 
 
Once the GCS developed the functionality tests taken place was through the internet and 
serial communication lines the software relies on. A telnet client was used to imitate the 
UAV in terms of data transmission through internet. Random data were sent and the 
transmission rate was faster than the GPRS usually handles. That ensured the memory 
allocated successful as there was not failures after certain time has elapsed. That also 
ensures that the GCS can be used with a UAV transmits over a faster communication 
link. 
 Furthermore, the GCS tested for any possible failures on invalid data 
transmissions. The GCS proven to reject any messages are not formatted as it could. 
Finally the GCS verified that generates messages which the UAV can understand and 
decode as discussed in sub-chapter 0.  
Stefanos Constantinou, Advanced Microelectronic Systems Engineering, 2011   53 
 6. EVALUATION 
 
The project had three main objectives. These were the integration of the remote 
controlled quad rotor helicopter to an autonomous vehicle, the generation of the GCS 
software as well as the communication link between them. 
 The integration of the software to a UAV objective was achieved, as soon as the 
UAV can travel through different positions and hold its position (hovers) for surveillance. 
However, automatic take-off and landing procedures are not yet functional and a RC 
transmitter is still required. There were two main reasons affected this objective. The first 
was the minimal time remained for software developing after the hardware assembly of 
the aircraft. Apart from that, the PCB was defective. A lot of time spent for the 
determination of whether was a PCB design error or due to a hardware component 
failure. Finally, the problem proven to be a manufacture error as there was resistance in 
the thru-hole vias. 
 On the other hand, the GCS application developed achieved all of its objectives. 
These are the three operational views have been described in chapter 4.3 (configuration, 
mission planning and flight data representation).  
 Furthermore, the communication link objective achieved as there is a bidirectional 
communication between the UAV and the GCS. The drawback of the communication 
link is its speed, but it was the only available solution featured long-range 
communication with minimal size and weight. In addition, GSM, which the GPRS relies 
on, is widely available in inhabitant areas where the project targets on as application 
environment. 
  
Stefanos Constantinou, Advanced Microelectronic Systems Engineering, 2011   54 
 7. FUTURE WORK 
 
Regarding the improvements would be made on the current project; the GPS receiver 
could be replaced with one that offering better update rates. Such receivers are now 
available at low cost. Thus, the issue of delayed determination of a reached position will 
be solved.  
 Furthermore, a new version of the remote controlled quad rotor software has been 
released. According to the description, the Òaltitude holdÓ algorithm became reliable. 
Hence, the modifications have been made on this project can be transferred to the new 
version of the software. As a result, the automatic take-off and landing functionality can 
be integrated there.  
 On the other hand, the GCS software can be improved by an algorithm predicts 
the trajectory of the UAV on the globe. As soon as the GCS software already obtains 
altitude information for a specified position, the trajectory prediction algorithm can be 
used to inform the UAV to change its altitude to avoid obstacles. 
 A worthy improvement of the project could be the replacement of the 16MHz 
microcontroller with a faster microprocessor or a digital signal processor. Such 
improvement will increase the stability of flight. Moreover, new functions that require 
further processing resources can be implemented.  
  
Stefanos Constantinou, Advanced Microelectronic Systems Engineering, 2011   55 
 8. BIBLIOGRAPHY 
Ê
[1]  ÒAeroquad, The Open Source Quadcopter,Ó [Online]. Available: http://www.aeroquad.com. 
[2]  E. Pastor, J. Lopez and P. Royo, ÒUAV Payload and Mission Control Hardware/Software 
Architecture,Ó Aerospace and Electronic Systems Magazine, IEEE, vol. 22, pp. 3-8, June 2007.  
[3]  S. Park, D. Won, M. Kang, T. Kim, H. Lee and S. Kwon, ÒRIC (robust internal-loop compensator) 
based flight control of a quad-rotor type UAV,Ó IEEE/RSJ International Conference onIntelligent 
Robots and Systems, 2005. (IROS 2005)., pp. 3542- 3547, 2005.  
[4]  A. Tayebi and S. McGilvray, ÒAttitude stabilization of a VTOL quadrotor aircraft,Ó IEEE Trans. 
Control Systems Technology, vol. 14, no. 3, pp. 562 - 571 , 2006.  
[5]  teipir, ÒPID Controllers,Ó [Online]. Available: 
http://gun.teipir.gr/DSAELAB/Ergastiriakes/pidtutorial.pdf. 
[6]  Wikipedia, ÒPID controller,Ó 2011. [Online]. Available: http://en.wikipedia.org/wiki/PID_controller. 
[7]  N. Metni, J.-M. Pflimlin, T. Hamel and P. Soueres, ÒAttitude and gyro bias estimation for a flying 
UAV,Ó Intelligent Robots and Systems, 2005. (IROS 2005). 2005 IEEE/RSJ International Conference 
on , pp. 1114 - 1120 , 2005.  
[8]  P. Martin and E. Salaun, ÒThe true role of accelerometer feedback in quadrotor control,Ó IEEE 
International Conference Robotics and Automation (ICRA), pp. 1623-1629, 3-7 May 2010, 2010.  
[9]  W. Premerlani and P. Bizard, ÒDirection Cosine Matrix IMU: Theory,Ó [Online]. Available: 
http://gentlenav.googlecode.com/files/DCMDraft2.pdf. 
[10]  ÒNMEA Description,Ó [Online]. Available: 
http://www.cs.put.poznan.pl/wswitala/download/pdf/NMEAdescription.pdf. 
[11]  G. Baddeley, ÒGPS - NMEA sentence information,Ó 2001. [Online]. Available: 
http://aprs.gids.nl/nmea/. 
[12]  S. Hrabar, Ò3D path planning and stereo-based obstacle avoidance for rotorcraft UAVs,Ó in 
Intelligent Robots and Systems, 2008. IROS 2008. IEEE/RSJ International Conference on, 2008.  
[13]  S. Bouabdallah and R. Siegwart, ÒFull control of a quadrotor,Ó in Intelligent Robots and Systems, 
2007. IROS 2007. IEEE/RSJ International Conference on, 2007.  
[14]  M. Barr, ÒEmbedded Systems Programming,Ó in Pulse Width Modulation, 2001, pp. 103-104. 
[15]  ÒI2C Manual,Ó Philips Semiconductors, [Online]. Available: 
http://www.nxp.com/documents/application_note/AN10216.pdf. 
[16]  A. Soumelidis, Design of an embedded microcomputer based mini quadrotor UAV, unpublished.  
[17]  J. Cai and D. Goodman, ÒGeneral packet radio service in GSM,Ó Communications Magazine, vol. 35, 
no. 10, pp. 122-131, 1997.  
[18]  M. Jovanovic and D. Starcevic, ÒSoftware Architecture for Ground Control Station for Unmanned 
Aerial Vehicle,Ó in Computer Modeling and Simulation, 2008.  
[19]  I. Papini, ÒVehicle Simulator reference manual,Ó 20 July 2010. [Online]. Available: 
http://www.hangsim.com/vsf/help/print.htm. 
[20]  A. Corporation, ÒATmega2560,Ó [Online]. Available: 
http://www.atmel.com/dyn/products/product_card.asp?category_id=163&family_id=607&subfamily
_id=1723&part_id=3632. 
[21]  Arduino, ÒArduino Mega,Ó [Online]. Available: http://arduino.cc/en/Main/ArduinoBoardMega. 
[22]  J. Zhong, ÒPID Controller Tuning: A Short Tutorial,Ó 2006. [Online]. Available: 
http://saba.kntu.ac.ir/eecd/pcl/download/PIDtutorial.pdf. 
[23]  ÒAT Commands Reference Guide,Ó Telit Wireless solutions, [Online]. Available: 
http://www.telit.com/module/infopool/download.php?id=542. 
[24]  radioman, ÒGMap.NET - Great Maps for Windows Forms & Presentation,Ó 2011. [Online]. 
Available: http://greatmaps.codeplex.com/. 
Stefanos Constantinou, Advanced Microelectronic Systems Engineering, 2011   56 
 [25]  T. Madani and A. Benallegue, ÒBackstepping Control for a Quadrotor Helicopter,Ó IEEE/RSJ 
International Conference on Intelligent Robots and Systems, pp. 3255-3260, 2006.  
[26]  G. Mao, S. Drake and B. Anderson, ÒDesign of an Extended Kalman Filter for UAV Localization,Ó 
Information, Decision and Control, 2007. IDC '07 , pp. 224 - 229 , 2007.  
[27]  S. Bouabdallah, A. Noth and R. Siegwart, ÒPID vs LQ control techniques applied to an indoor micro 
quadrotor,Ó in Intelligent Robots and Systems, 2004.  
 
Stefanos Constantinou, Advanced Microelectronic Systems Engineering, 2011   57 
 STEP 2 Ð Calibration  
9.  APPENDICES 
1. Visit the www.aeroquad.info to download the configurator 
 
software (note: the software transformed to UAV is 2.4, find a 
9.1. UAV SYSTEM USER MANUAL  
 compatible version of configurator). 
2. Connect the USB cable and start the configurator, set as COM 
the one the Arduino is connected to.  
Baud rate of COM port: 115200 
3. Follow the instructions to calibrate the EEPROM, ESCs RC 
transmitter, and the magnetometer 
4. Close port and then close the configurator Software 
STEP 3 Ð GPS Navigation setup 
 
 
STEP 1 - Loading the sketch 
1. Start the UAV GCS software 
1. If you are planning to use GPRS connectivity, please attach a 
2. Select the COM port Arduino is connected, default baud rate 
SIM card in the slot 
(115200) and click ÒOpen PortÓ 
2. Using the Arduino IDE software, load the sketch named: 
3. Place to vehicle to a level position and navigate to ÒVisual 
QuadrotorUAVsoftware.pde 
ViewÓ tab. Verify the vehicle appears level. If not click the 
3. Locate the file named Aeroquad.h 
Òcalibrate levelÓ button 
4. Find the line: #define SIMPIN "" 
4. Click the ÒGet GPS PID valuesÓ if you have not changed the 
5. Enter the pin code of the SIM card if any (leave it as is if you 
default ones, ensure they are: 0.3;0;0;0.3;0;0 
have not set any PIN code on the card) 
5. Ensure your firewall does not block the GCS port shown. If 
6. Locate the file: GM862.cpp 
you are behind a router, forward that port on your computer. 
7. Find the line contains 
6. Click the ÒStart listeningÓ button found on top right position  
8. Modify the following line according to the SIM network you 
7. Click the ÒEnable GPS/GPRS moduleÓ. Wait until the UAV 
are on:  
reports Òready!Ó on the console. The ÒUAV IP:Ó will become 
requestModem("AT+CGDCONT=1,\"IP\",\"m-bb.o2.co.uk\"", 
available. The connection status will change to ÓConnected to 
3000, true, buf); 
UAVÓ  
(leave it as is if you are on O2 mobile broadband) 
  
9. Save and upload the sketch 
 
Stefanos Constantinou, Advanced Microelectronic Systems Engineering, 2011   58 
 STEP 4 Ð Plan your missions The ÒFlight dataÓ view keeps track of the UAV. You can also 
1. You can disconnect the USB cable now unless you prefer observe its orientation. Check the battery voltage-percentage on 
uploading the mission via cable a regular basis. 
2. Navigate to the ÒMission plannerÓ view 
To change its trajectory, just right click the map to the desired 
NOTE: You can upload up to 10 positions max! 
position and click Òfly hereÓ 
3. Find the places you are interested of and mark them up: 
Right clicks are sets new marker 
If the last position in the mission list is the base, it will hover 
Left click on marker removes it 
above you. If not, use the Òfly hereÓ feature to bring it near you. 
(Note: only green markers are transferred to the vehicle 
Land it by turning off the GPS Navigation and using the throttle 
for navigation) 
stick. 
4. Upload the mission either via the USB cable or via the 
internet link 
5. Optional: navigate back to configurator mode and click 
ÒGet stored missionsÓ. Verify the correctness. 
STEP 5 Ð The flight 
1. Navigate to the Òflight dataÓ view 
2. Navigate  to ÒRemote DataÓ tab, you will see raw data 
coming from the UAV and the HUD will start moving 
3. Wait until the ÒGPS fixÓ led indicator on the UAV is 
turned on. 
4. Test that the ÒGPS NavÓ LED is getting ON when 
switching the upper right auxiliary button of the 
transmitter. 
5. Turn it off  
6. Take-off the vehicle to the desired altitude. 
7. Enable the autonomous navigation by turning the upper 
right auxiliary button.  
Stefanos Constantinou, Advanced Microelectronic Systems Engineering, 2011   59 
 9.2. PCB Hardware Design - Interface 
 
The following figures show the design of the PCB developed. On the right hand side the schematic is shown while on the left is the actual board 
magnified 
 
 
Stefanos Constantinou, Advanced Microelectronic Systems Engineering, 2011   60 
 